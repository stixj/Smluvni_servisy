<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Výpočet půjčovného za náhradní vozidlo - Direct pojišťovna</title>
    <style>
        /* DirectSans Font Faces */
        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-Italic.otf') format('opentype');
            font-weight: 400;
            font-style: italic;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-Medium.otf') format('opentype');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-MediumItalic.otf') format('opentype');
            font-weight: 500;
            font-style: italic;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-Semibold.otf') format('opentype');
            font-weight: 600;
            font-style: normal;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-SemiboldItalic.otf') format('opentype');
            font-weight: 600;
            font-style: italic;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-Bold.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: 'DirectSans';
            src: url('Písma/DirectSans-BoldItalic.otf') format('opentype');
            font-weight: 700;
            font-style: italic;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ======== GLOBAL BRAND STYLES ======== */

        /* 1️⃣  Základní barvy */
        :root {
            --brand-green: #004033;
            --lime-brand: #C4DE00;
            --lime-soft: #FAFCEB;
            --lime-warm: #F6FBEA;
        }

        /* 2️⃣  Globální pozadí */
        body {
            background-color: var(--lime-warm); /* sjednocené pozadí */
            color: var(--brand-green);
            font-family: 'DirectSans', sans-serif;
            font-size: 17px;
            line-height: 1.65; /* více dechu */
            letter-spacing: 0.1px;
            background-attachment: fixed;
            min-height: 100vh;
            font-weight: 400;
        }
        
        /* Base typography - all text 400 */
        p, span, div, li {
            font-weight: 400;
            line-height: 1.6;
            font-size: 16px;
            letter-spacing: 0.1px;
        }

        /* 3️⃣  Boxy, sekce, kontejnery */
        /* Jednotný styl boxů */
        .box, .info-box, .highlight-box {
            background: #F4F8C9; /* jemně teplejší lime */
            border: 1px solid #E6EEB8;
            border-top: 3px solid var(--lime-brand);
            border-radius: 24px; /* sjednoceno s CTA */
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 64, 51, 0.06); /* jemná hloubka */
        }

        /* Hover a interakce */
        .box:hover, .info-box:hover, .highlight-box:hover {
            box-shadow: 0 4px 12px rgba(0, 64, 51, 0.08);
            transition: 0.3s ease-in-out;
        }

        /* 7️⃣ Drobné interaktivity a plynulost */
        a, button, tr, .box {
            transition: all 0.25s ease;
        }

        /* 4️⃣  Tabulka (Ceník vozidel) */
        .direct-price-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 16px;
            overflow: hidden;
            background: #FFFFFF;
            border: 1px solid #E6EEB8;
            box-shadow: 0 2px 6px rgba(0, 64, 51, 0.05);
        }

        /* Hlavička */
        .direct-price-table thead {
            background: #F6F9E8;
            border-bottom: 2px solid #C4DE00;
        }
        .direct-price-table th {
            font-size: 15px;
            font-weight: 600;
            padding: 14px 18px;
            color: #004033;
            border-right: 1px solid #E6EEB8;
        }
        .direct-price-table th:last-child { border-right: none; }

        /* Kategorie */
        .direct-price-table .category-row td:first-child {
            border-left: 3px solid #C4DE00;
            background: #FAFCEB;
            font-weight: 600;
            color: #004033;
            padding: 14px 18px;
        }

        /* Běžné řádky */
        .direct-price-table td {
            padding: 14px 18px;
            font-size: 15px;
            line-height: 1.5;
            color: #004033;
            border-bottom: 1px solid #E6E9E8;
        }

        /* Hover */
        .direct-price-table tr:hover td {
            background: rgba(196, 222, 0, 0.08);
            transition: 0.2s ease;
        }

        /* Zarovnání cen */
        .direct-price-table td:last-child {
            text-align: right;
            font-weight: 600;
        }

        /* 5️⃣ CTA tlačítka */
        button.cta, .cta-button {
            background: #C4DE00;
            color: #004033;
            border: none;
            border-radius: 9999px; /* pilulka */
            padding: 14px 36px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 64, 51, 0.15);
            transition: all 0.25s ease;
        }

        button.cta:hover, .cta-button:hover {
            background: linear-gradient(180deg, #C4DE00 0%, #D4F100 100%);
            box-shadow: 0 6px 14px rgba(0, 64, 51, 0.25);
            transform: translateY(-1px);
        }

        .calculation-message {
            background: #e9f6de;
            border: 1px solid rgba(196, 222, 0, 0.6);
            border-radius: 16px;
            color: var(--brand-green);
            font-weight: 600;
            font-size: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            line-height: 1.4;
            padding: 0 20px;
            margin: 0 0 0 0;
            opacity: 0;
            transform: translateY(-6px);
            transition: opacity 0.35s ease, transform 0.35s ease, max-height 0.35s ease, padding 0.35s ease, margin 0.35s ease;
            max-height: 0;
            overflow: hidden;
            visibility: hidden;
            pointer-events: none;
        }

        .calculation-message.visible {
            opacity: 1;
            transform: translateY(0);
            padding: 12px 20px;
            margin: 0 0 20px;
            max-height: 120px;
            visibility: visible;
            pointer-events: auto;
        }

        /* 6️⃣ Doplňující informace */
        .supplementary-info {
            background: #FFFFFF;
            border: 1px solid #E6EEB8;
            border-top: 3px solid #C4DE00;
            border-radius: 24px;
            padding: 36px 32px;
            box-shadow: 0 2px 8px rgba(0, 64, 51, 0.05);
        }

        .supplementary-info h3 {
            font-size: 18px;
            font-weight: 700;
            color: #004033;
            margin-bottom: 20px;
        }

        .supplementary-info li {
            font-size: 15px;
            line-height: 1.65;
            color: #004033;
            margin-bottom: 10px;
        }

        .supplementary-info li::marker {
            color: #C4DE00;
        }

        /* Header */
        .header {
            background: 
                linear-gradient(90deg, rgba(185,207,0,0.1) 0%, transparent 100%),
                linear-gradient(90deg, rgba(0,64,51,0.9) 0%, rgba(0,64,51,0.8) 50%, rgba(0,64,51,0.9) 100%),
                url('images/direct-car-bg.jpg') center/cover no-repeat;
            background-blend-mode: normal, normal, normal;
            color: #FFFFFF;
            padding: 30px 60px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 100;
            position: relative;
            transition: box-shadow 0.3s ease;
        }
        
        body.scrolled .header {
            box-shadow: 0 2px 8px rgba(0, 64, 51, 0.1);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 64, 51, 0.8);
            z-index: 0;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 50px;
            justify-content: space-between;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo img,
        .logo-img {
            height: 75px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            position: relative;
            z-index: 2;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }

        .logo-text .logo-green {
            font-size: 32px;
            color: #FFFFFF;
            font-family: 'DirectSans', sans-serif;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .logo-text .logo-black {
            color: #FFFFFF;
            font-family: 'DirectSans', sans-serif;
            font-size: 14px;
            font-weight: 400;
            margin-top: 2px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .header-nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: #FFFFFF;
            font-weight: 500;
            padding: 10px 26px;
            border-radius: 999px;
            transition: 0.2s ease;
            text-decoration: none;
            font-size: 16px;
            font-family: 'DirectSans', sans-serif;
            background-color: transparent;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .nav-link:active {
            transform: translateY(0) scale(0.97);
        }

        .nav-link::after {
            display: none;
        }

        .nav-link:hover {
            color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link.active {
            background: #C4DE00;
            color: #004033;
            font-weight: 600;
            transform: translateY(0);
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 64, 51, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: none;
        }
        
        .nav-link.active::after {
            display: none;
        }

        .nav-link.active:hover {
            background: linear-gradient(180deg, #C4DE00 0%, #D4F100 100%);
            color: #004033;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 64, 51, 0.25);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            background-color: transparent;
            padding: 80px 40px;
            box-shadow: none;
        }

        .form-container {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0, 64, 51, 0.05);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease-in-out;
            position: relative;
            z-index: 0;
            overflow: visible;
        }
        
        .form-container.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-title {
            font-family: 'DirectSans', sans-serif;
            font-size: 34px;
            font-weight: 700;
            color: #004033;
            margin-top: 32px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.6;
            letter-spacing: -0.2px;
            animation: fadeIn 0.35s ease-out;
            position: relative;
        }
        
        .page-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 3px;
            margin: 10px auto 0;
            background: linear-gradient(90deg, #D4E84D 0%, #C4DE00 100%);
            border-radius: 2px;
            animation: expandLine 0.6s ease-out 0.3s both;
        }
        
        @keyframes expandLine {
            from {
                width: 0;
                opacity: 0;
                transform-origin: center;
            }
            to {
                width: 100px;
                opacity: 1;
                transform-origin: center;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .form-section {
            margin-top: 24px;
            margin-bottom: 24px;
            padding: 20px;
            background: #FFFFFF;
            border-radius: 16px;
            animation: fadeInUp 0.35s ease-out;
            animation-fill-mode: both;
            position: relative;
            z-index: 0;
            overflow: visible;
            box-shadow: none;
            border: 1px solid #EAEAEA;
            transition: all 0.25s ease-in-out;
        }
        
        /* Jemné optické oddělení + „zebra“ efekt pro sekce ve výpočtu */
        .form-container .form-section:nth-of-type(even) {
            background: #FAFBF9;
        }
        
        /* Increased padding for "Pronajímané vozidlo" section - unified to 32px */
        .rental-vehicle-section {
            padding: 20px;
        }
        
        .form-section:first-of-type {
            margin-top: 0;
        }
        
        .form-section:hover {
            transform: translateY(-1px);
        }
        
        /* Form box hover effect */
        .form-box {
            transition: all 0.25s ease-in-out;
        }
        
        .form-box:hover {
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }
        
        /* Category rates box hover */
        .category-rates:hover {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
            transition: all 0.25s ease-in-out;
        }
        
        .form-section:has(.form-group:focus-within) {
            z-index: 1;
            overflow: visible;
        }
        
        .form-section:nth-child(1) { animation-delay: 0.05s; }
        .form-section:nth-child(2) { animation-delay: 0.1s; }
        .form-section:nth-child(3) { animation-delay: 0.15s; }
        .form-section:nth-child(4) { animation-delay: 0.2s; }

        /* Visual separation between damaged vehicle category section and rental vehicle section */
        #damagedVehicleCategorySection + .form-section {
            margin-top: 24px;
            padding-top: 1.5rem;
        }

        /* Nadpisy sekcí */
        h2.section-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 18px;
            color: #003E2F;
        }

        /* Zvýraznění částí textu */
        strong, b {
            color: #004033;
            font-weight: 600;
        }
        
        /* H2 styling - unified */
        h2 {
            font-family: 'DirectSans', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: #004033;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.25rem;
            position: relative;
            overflow: visible;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-family: 'DirectSans', sans-serif;
            font-size: 16px;
            font-weight: 400;
            color: #295A50;
            margin-bottom: 10px;
            letter-spacing: -0.2px;
            line-height: 1.6;
        }

        .form-group label .required {
            color: #e74c3c;
        }

        /* Info icon with tooltip */
        .info-icon {
            display: inline-block;
            cursor: pointer;
            color: #C4DE00;
            font-size: 13px;
            margin-left: 6px;
            margin-right: 4px;
            vertical-align: middle;
            position: relative;
            transition: color 0.25s ease-in-out;
        }

        .info-icon:hover {
            color: #B4D100;
        }

        .info-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            padding: 6px 10px;
            background-color: #004033;
            color: #FFFFFF;
            font-size: 13px;
            line-height: 1.6;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 10002;
            font-weight: 400;
            font-family: 'DirectSans', sans-serif;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .info-icon::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 2px;
            border: 5px solid transparent;
            border-top-color: #004033;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 10003;
        }

        .info-icon:hover::after,
        .info-icon:hover::before {
            opacity: 1;
        }

        /* Mobile tooltip support */
        @media (max-width: 768px) {
            .info-icon:active::after,
            .info-icon:active::before {
                opacity: 1;
            }
        }

        .form-group {
            position: relative;
            z-index: 1;
            overflow: visible;
        }
        
        .form-group:focus-within {
            z-index: 10000;
            overflow: visible;
        }
        
        .form-group:focus-within .autocomplete-dropdown {
            z-index: 10001;
        }

        /* Autocomplete inputs styled like select with chevron */
        .form-group.autocomplete-select input {
            padding-right: 44px;
        }

        .autocomplete-input-wrapper {
            position: relative;
        }

        .autocomplete-input-wrapper::after {
            content: "";
            position: absolute;
            top: 50%;
            right: 18px;
            transform: translateY(-50%) rotate(0deg);
            width: 20px;
            height: 20px;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: 20px 20px;
            transition: transform 0.2s ease;
        }

        .form-group.autocomplete-select.open .autocomplete-input-wrapper::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .form-group input {
            font-family: 'DirectSans', sans-serif;
            padding: 12px 14px;
            border: none;
            border-bottom: 1px solid #E0E0E0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 400;
            color: #004033;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: #FFFFFF;
            width: 100%;
            letter-spacing: -0.2px;
            line-height: 1.6;
        }
        
        .form-group input::placeholder {
            color: #888;
        }
        
        .form-group input:hover {
            border-bottom-color: #B9CF00;
            transform: translateY(-1px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-group input:focus {
            outline: none;
            border: none;
            border-bottom: 2px solid #B9CF00;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(185, 207, 0, 0.15), 0 0 0 3px rgba(185, 207, 0, 0.1);
        }

        .form-group input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
            transition: all 0.2s ease-in-out;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .form-group input:disabled:hover {
            border-bottom-color: #e0e0e0;
            background-color: #f5f5f5;
            box-shadow: none;
        }
        
        /* Modern unified select styling (Direct UI-like) */
        .form-group select {
            font-family: 'DirectSans', sans-serif;
            width: 100%;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border-radius: 10px;
            border: 1px solid #E2E2E2;
            background-color: #FFFFFF;
            color: #1E1E1E;
            font-size: 14px;
            padding: 10px 44px 10px 12px;
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 18px center;
            background-size: 14px 14px;
            letter-spacing: -0.2px;
            line-height: 1.6;
            box-shadow: none;
        }

        /* Hide default arrow in old IE/Edge */
        .form-group select::-ms-expand {
            display: none;
        }

        .form-group select:hover {
            border-color: #B9CF00;
        }

        .form-group select:focus {
            outline: none;
            border-color: #1FA86A;
            box-shadow: 0 0 0 2px rgba(31, 168, 106, 0.2);
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #fff;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10000;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            pointer-events: none;
        }
        
        .autocomplete-dropdown.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInDown 0.2s ease-in-out;
            pointer-events: auto;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            font-family: 'DirectSans', sans-serif;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease-in-out;
            position: relative;
            pointer-events: auto;
            user-select: none;
            line-height: 1.6;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background-color: #F6F9E8;
            color: #004033;
            transform: translateX(3px);
        }
        
        .autocomplete-item:hover::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: var(--lime-brand);
        }
        
        .autocomplete-item.selected {
            background-color: #F6F9E8;
            color: #004033;
            font-weight: 500;
            animation: fadeInSelection 0.2s ease-in-out;
        }
        
        @keyframes fadeInSelection {
            from {
                background-color: #FFFFFF;
            }
            to {
                background-color: #F6F9E8;
            }
        }
        
        .autocomplete-item:active {
            transform: translateX(3px) scale(0.98);
        }


        .date-input-wrapper {
            position: relative;
        }

        .date-input-wrapper input {
            padding-right: 40px;
        }

        .date-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #555555;
        }

        /* Category Content Container */
        #damagedVehicleCategoryContent {
            display: flex;
            flex-direction: column;
        }
        
        #damagedVehicleCategorySection {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        
        #damagedVehicleCategorySection.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Category Result Intro */
        .category-result-intro {
            font-size: 16px;
            color: #7D7D7D;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        /* Rental Vehicle Intro */
        .rental-vehicle-intro {
            font-size: 16px;
            color: #7D7D7D;
            margin-bottom: 12px;
            line-height: 1.6;
            font-weight: 500;
            padding-left: 12px;
            border-left: 4px solid #C4DE00;
        }

        /* Category Info Section */
        .category-info {
            margin-bottom: 1.25rem;
        }

        .category-name {
            font-size: 20px;
            font-weight: 700;
            color: #004033;
            margin-bottom: 10px;
            background: #FFFFFF;
            border-bottom: 1px solid #E5E7EB;
            padding: 0.75rem 1.25rem;
            border-radius: 6px;
            display: inline-block;
            box-shadow: 0 2px 6px rgba(0, 64, 51, 0.04);
            letter-spacing: -0.2px;
        }
        
        /* Class box for vehicle category highlighting */
        .category-name.class-box {
            background: #004033 !important;
            color: #FFFFFF !important;
            border: none !important;
            padding: 6px 18px !important;
            border-radius: 999px !important;
            margin-bottom: 12px !important;
            box-shadow: 0 2px 8px rgba(0, 64, 51, 0.1) !important;
            transition: all 0.25s ease-in-out;
            font-weight: 700 !important;
            font-size: 14px !important;
            display: inline-block !important;
        }
        
        .category-name.class-box:hover {
            background: #004033 !important;
            filter: brightness(1.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 64, 51, 0.15) !important;
        }
        
        .class-box {
            background: #004033;
            color: #FFFFFF;
            border: none;
            padding: 6px 18px;
            border-radius: 999px;
            margin-bottom: 12px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 64, 51, 0.1);
            transition: all 0.25s ease-in-out;
            display: inline-block;
        }
        
        .class-box:hover {
            background: #004033;
            filter: brightness(1.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 64, 51, 0.15);
        }

        .category-note {
            font-size: 14px;
            font-weight: 400;
            color: #7D7D7D;
            font-style: italic;
            margin-top: 5px;
            line-height: 1.6;
            letter-spacing: -0.2px;
        }

        .category-rates {
            background: var(--lime-warm);
            border: 1px solid #ebe7e5;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 0;
            margin-top: 0;
            box-shadow: 0 2px 4px rgba(0,64,51,0.05);
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .rate-item:first-of-type {
            border-top: 1px solid #E6EEB8;
            margin-top: 8px;
            padding-top: 10px;
        }
        
        .rate-item:nth-of-type(2) {
            margin-top: 8px;
            border-top: 1px solid #E6EEB8;
            padding-top: 10px;
        }

        .rate-item:last-child {
            border-bottom: none;
        }

        .rate-label {
            font-size: 16px;
            font-weight: 500;
            color: #004033;
            line-height: 1.6;
            letter-spacing: -0.2px;
        }

        .rate-microtext {
            font-size: 13px;
            color: #004033;
            margin-top: 8px;
            font-style: italic;
            line-height: 1.6;
        }

        .discount-info {
            font-size: 16px;
            margin-top: 6px;
            line-height: 1.6;
            font-style: italic;
            color: #7D7D7D;
        }

        .rate-value {
            font-size: 22px;
            font-weight: 600;
            color: #004033;
            line-height: 1.6;
            letter-spacing: -0.2px;
        }

        .category-models {
            margin-top: 24px;
            margin-bottom: 0;
            padding-top: 1.25rem;
            border-top: 1px solid #E5E7EB;
        }

        .category-models-summary {
            margin-top: 20px;
            margin-bottom: 0;
            padding: 16px 24px;
            background-color: var(--lime-warm);
            border-radius: 12px;
            border-left: 3px solid #E6EEB8;
            box-shadow: 0 2px 4px rgba(0,64,51,0.05);
        }

        .models-category-title {
            font-size: 18px;
            font-weight: 600;
            color: #004033;
            margin-bottom: 4px;
            margin-top: 0;
        }

        .models-category-description {
            font-size: 16px;
            color: #7D7D7D;
            margin-bottom: 12px;
            line-height: 1.6;
            margin-top: 0;
        }
        
        .models-summary-text {
            font-size: 16px;
            color: #7D7D7D;
            line-height: 1.6;
            margin: 0;
            font-style: italic;
        }
        
        .models-summary-text strong {
            font-weight: 600;
            color: #004033;
        }

        .models-title {
            font-size: 20px;
            font-weight: 700;
            color: #004033;
            margin-bottom: 1.25rem;
            margin-top: 0;
            letter-spacing: -0.2px;
        }

        .models-table-container {
            overflow-x: auto;
            margin-top: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 64, 51, 0.05);
        }

        .models-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'DirectSans', sans-serif;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: none;
            font-size: 14px;
        }

        .models-table thead {
            background-color: #F6F9E8;
            border-radius: 12px 12px 0 0;
            border-bottom: 2px solid #C4DE00;
        }

        .models-table th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #004033;
            white-space: nowrap;
            position: relative;
        }

        /* Subtle divider lines in header - not full width */
        .models-table th:not(:first-child)::before {
            content: '';
            position: absolute;
            left: 0;
            top: 15%;
            bottom: 15%;
            width: 1px;
            background-color: #E5E7EB;
            opacity: 0.5;
        }

        .models-table th:first-child {
            border-radius: 8px 0 0 0;
        }

        .models-table th:last-child {
            border-radius: 0 8px 0 0;
        }

        .models-table th:nth-child(2),
        .models-table th:nth-child(3) {
            text-align: right;
        }

        .models-table td {
            padding: 8px;
            border-bottom: 1px solid #E6E9E8;
            position: relative;
            line-height: 1.7;
        }
        
        .models-table tbody tr:nth-child(even) {
            background-color: #F9FAF8;
        }

        /* Subtle divider lines - not full width, elegant spacing */
        .models-table tbody tr td:not(:first-child)::before {
            content: '';
            position: absolute;
            left: 0;
            top: 20%;
            bottom: 20%;
            width: 1px;
            background-color: #E5E7EB;
            opacity: 0.5;
        }

        .models-table td:nth-child(2),
        .models-table td:nth-child(3) {
            text-align: right;
        }

        .models-table td strong {
            font-weight: 600;
            color: #004033;
        }

        .models-table tbody tr {
            transition: background-color 0.25s ease-in-out;
            border-left: 3px solid transparent;
        }
        
        .models-table tbody tr:hover {
            background-color: #F6F9E8;
            border-left: 3px solid #C4DE00;
            transition: background 0.2s ease, border-left 0.2s ease;
        }

        .models-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Results */
        .results-section {
            background: #FAFBF9;
            border-radius: 16px;
            border-top: 3px solid #CDE2B8;
            border: 1px solid #EAEAEA;
            box-shadow: none;
            padding: 20px 20px 24px;
            margin: 24px 0 24px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        
        .results-section.visible {
            opacity: 1;
            transform: translateY(0);
            animation: fadeInResults 0.3s ease-in-out;
        }
        
        @keyframes fadeInResults {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Result box animation */
        .result-box {
            opacity: 0;
            transform: translateY(5px);
            transition: all 0.3s ease-in-out;
        }
        
        .result-box.visible {
            opacity: 1;
            transform: translateY(0);
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(5px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .results-section {
            animation: fadeIn 0.3s ease-in;
        }
        
        .result-box:hover {
            transition: all 0.25s ease-in-out;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.75rem 0;
            border-bottom: 1px solid #E5E7EB;
            gap: 20px;
        }
        
        .result-row:first-of-type {
            border-top: 1px solid #E6EEB8;
            margin-top: 8px;
            padding-top: 0.75rem;
        }
        
        .result-row:nth-of-type(2) {
            margin-top: 8px;
            border-top: 1px solid #E6EEB8;
            padding-top: 0.75rem;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label-wrapper {
            flex: 1;
            min-width: 280px;
            flex-shrink: 0;
        }

        .result-label {
            font-family: 'DirectSans', sans-serif;
            font-size: 16px;
            font-weight: 400;
            color: #004033;
            white-space: nowrap;
            opacity: 0.8;
            line-height: 1.6;
            letter-spacing: -0.2px;
        }

        .result-value-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
        }

        .result-value {
            font-family: 'DirectSans', sans-serif;
            font-size: 22px;
            font-weight: 600;
            color: #003E2F;
            line-height: 1.6;
            letter-spacing: -0.2px;
            padding: 4px 0;
        }

        .result-note {
            font-family: 'DirectSans', sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: #004033;
            font-style: italic;
            margin-top: 4px;
            line-height: 1.6;
            letter-spacing: -0.2px;
        }

        .cta-button {
            font-family: 'DirectSans', sans-serif;
            background: #C4DE00;
            color: #004033;
            font-weight: 600;
            font-size: 16px;
            padding: 14px 36px;
            border: none;
            border-radius: 9999px; /* pilulka */
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 64, 51, 0.15);
            transition: all 0.25s ease;
            min-width: 180px;
            min-height: 48px;
            margin: 28px auto 0;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .cta-button:hover {
            background: linear-gradient(180deg, #C4DE00 0%, #D4F100 100%);
            box-shadow: 0 6px 14px rgba(0, 64, 51, 0.25);
            transform: translateY(-1px);
        }
        
        .cta-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 64, 51, 0.2);
        }

        .btn-print {
            font-family: 'DirectSans', sans-serif;
            background-color: #FFFFFF;
            color: #004033;
            padding: 10px 20px;
            border: 1px solid #004033;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .btn-print:hover {
            background-color: rgba(196, 222, 0, 0.1);
            color: #004033;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-print:active {
            transform: scale(0.98);
        }

        .btn-reset {
            font-family: 'DirectSans', sans-serif;
            background-color: #FFFFFF;
            color: #004033;
            padding: 10px 20px;
            border: 1px solid #004033;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .btn-reset:hover {
            background-color: rgba(196, 222, 0, 0.1);
            color: #004033;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-reset:active {
            transform: scale(0.98);
        }

        /* Secondary buttons container */
        .secondary-buttons {
            gap: 12px;
            display: flex;
        }

        /* Hide print footer elements on screen */
        .print-date {
            display: none !important;
            visibility: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        .print-footer-contact {
            display: none !important;
            visibility: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Override in print - must be after screen styles */
        @media print {
            .print-date,
            .print-footer-contact {
                left: auto !important;
                right: auto !important;
            }
        }
        
        /* Print styles are defined in @media print section below */
        
        .footer-text {
            font-family: 'DirectSans', sans-serif;
            font-size: 16px;
            font-weight: 400;
            color: #7D7D7D;
            line-height: 1.6;
            letter-spacing: 0.1px;
            margin-top: 24px;
            margin-bottom: 24px;
            padding: 36px 32px;
            border-top: 3px solid #C4DE00;
            background-color: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0 2px 6px rgba(0,64,51,0.05);
        }

        .footer-text h3 {
            color: #003E2F !important;
            font-family: 'DirectSans', sans-serif !important;
            font-size: 22px !important;
            font-weight: 700 !important;
            margin-bottom: 22px !important;
            margin-top: 0 !important;
            position: relative !important;
        }

        .footer-text h3::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background-color: #003E2F;
            margin-top: 8px;
            border-radius: 2px;
        }

        /* === Footer === */
        .footer {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 40px 60px;
            background: linear-gradient(90deg, #004033 0%, #015B48 100%);
            border-top: 3px solid rgba(185, 207, 0, 0.9);
            color: rgba(255, 255, 255, 0.9);
            font-family: 'DirectSans', sans-serif;
            font-size: 13px;
            line-height: 1.7;
            letter-spacing: 0.1px;
            margin-top: -100px;
            z-index: 1;
            box-shadow: 0 -4px 8px rgba(0, 64, 51, 0.08);
        }
        /* Ensure footer typography matches index.html (override global p/span sizing) */
        .footer,
        .footer p,
        .footer span,
        .footer a {
            font-size: 13px;
            line-height: 1.7;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 50px;
        }

        .footer-left {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .footer-left span {
            color: rgba(255, 255, 255, 0.9);
        }

        .footer-right {
            text-align: right;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .footer a {
            color: #C4DE00;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease-in-out;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .footer-right p {
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            line-height: 1.6;
        }
        
        /* Typography for supplementary information */
        .doplnujici-info {
            background: #FFFFFF;
            border: 1px solid #E6EEB8;
            border-top: 3px solid #C4DE00;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 400;
            color: #004033;
            padding: 24px 24px 28px;
            margin-top: 24px;
            box-shadow: none;
            line-height: 1.6;
            letter-spacing: 0.1px;
        }

        .supplementary-info-columns {
            display: flex;
            gap: 32px; /* sjednocený horizontální odstup mezi sloupci doplňujících informací */
            margin-top: 15px;
            align-items: flex-start; /* zajistí, že oba sloupce začínají ve stejné výšce */
        }

        .supplementary-info-column {
            flex: 1;
        }

        .supplementary-info-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .supplementary-info-column li {
            color: #004033;
            font-size: 15px;
            line-height: 1.65;
            letter-spacing: -0.2px;
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .supplementary-info-column li:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #C4DE00;
            font-weight: bold;
            font-size: 14px;
            line-height: 1.5;
        }

        .supplementary-info-column li:last-child {
            margin-bottom: 0;
        }

        /* Print summary layout (used only for PDF/print) */
        .print-summary {
            display: none;
            font-family: 'Nunito Sans', 'DirectSans', sans-serif;
            font-size: 12px;
            line-height: 1.6;
            color: #004734;
        }
        
        .print-summary-inner {
            display: flex;
            flex-direction: column;
            gap: 0;
            padding: 0;
        }
        
        .print-summary-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 18px; /* tightened space under yellow line for more compact header-to-content transition */
            border-bottom: 1px solid #E2E2E2;
            padding-bottom: 10px;
        }
        
        .print-header-top {
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            margin-bottom: 12px; /* slightly tighter space under logo for better vizuální rovnováhu s nadpisem */
        }
        
        .print-summary-header .print-logo-mini img {
            height: 40px; /* logo height approx. 40 px, keep proportions */
            width: auto;
            margin-top: -2px; /* jemně posunuto dolů o cca 2–3 px tak, aby optická osa loga lépe lícovala s nadpisem */
        }

        .print-header-date {
            font-size: 11px;
            color: #7D7D7D;
        }

        .print-summary-title {
            font-size: 18px;
            font-weight: 700;
            color: #004734;
            text-align: center;
            position: relative;
            padding-bottom: 4px;
        }
        
        .print-summary-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 2px;
            background-color: #D7E56F;
            margin: 4px auto 0; /* slightly reduced gap between title text and yellow line (was 6px) */
            border-radius: 999px;
        }
        
        .print-section-box {
            background: #FFFFFF;
            border-radius: 8px;
            padding: 14px 16px;
            border: 1px solid #EAEAEA;
            margin-top: 0;
            margin-bottom: 24px;
        }

        /* Optické oddělení mezi „Výsledná sazba“ a následující sekcí bez rozbití konzistentní mezery 24 px */
        .print-section-box.print-section-box-highlight + .print-section-box {
            border-top: 1px solid #EAEAEA; /* jemná dělicí linka mezi boxy */
            padding-top: 18px;
        }
        
        .print-section-box-highlight {
            background-color: #FAFBF9; /* light yellow highlight for key rate section */
        }

        /* Models-in-category box in print summary */
        .print-section-box-models {
            background-color: #FBFCFA; /* slightly lighter background for better print contrast while keeping consistency with „Výsledná sazba“ */
            margin-bottom: 20px; /* ~4 px tighter spacing under models section to better integrate with surrounding blocks (24 px → 20 px) */
        }

        .print-models-title {
            font-size: 13px;
            font-weight: 700;
            color: #004734;
            margin: 0 0 6px 0;
        }

        .print-models-description {
            font-size: 12px;
            color: #7D7D7D;
            margin: 0 0 10px 0;
            line-height: 1.5;
        }

        .print-models-summary {
            font-size: 12px;
            color: #004734;
            line-height: 1.5;
            margin: 0;
            margin-top: -2px; /* subtle optical alignment tweak so first line of model list sits on same visual line as section title */
            font-style: italic; /* models italic by default */
        }

        .print-models-summary strong {
            font-weight: 600;   /* brand bold */
            font-style: normal; /* brand not italic */
        }

        /* Extra visual separation for rental rate section in print summary –
           oddělení mezi „Pronajímané vozidlo“ a „Výsledná sazba pronajímaného vozidla“ */
        .print-section-box-rental-rate {
            border-top: 1px solid #EAEAEA;
            padding-top: 18px;
            margin-bottom: 28px; /* o 4 px větší mezera pod sekcí (24 px → 28 px) pro jasnější oddělení od „Doplňujících informací“ */
        }

        .print-section-box h2 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #004734;
        }

        .print-row {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 4px;
        }
        
        .print-label {
            flex: 1;
            text-align: left;
        }
        
        .print-value {
            flex: 0 0 auto;
            text-align: right;
            font-weight: 600;
            color: #003E2F;
        }

        .print-rate-table {
            margin-top: 4px;
        }

        .print-rate-table .print-row {
            padding-bottom: 3px;
            margin-bottom: 5px;
            border-bottom: 1px solid #E6E9E8;
        }

        .print-rate-table .print-row:last-child {
            border-bottom: none;
        }

        .print-note {
            margin-top: 4px;
            font-size: 11px;
            color: #7D7D7D;
        }

        /* Dvou-sloupcové „Doplňující informace“ v tiskovém souhrnu */
        .print-section-box ul.print-note {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr)); /* two balanced columns */
            column-gap: 32px; /* horizontal gap between columns – keep as requested */
            row-gap: 6px;
            padding-left: 18px;
            margin-top: 4px;
            font-size: 12px;
            line-height: 1.5; /* slightly tighter leading for more compact, professional print look */
            color: #004734;
            list-style-position: outside;
            align-items: start; /* ensure bullets in both columns share the same top offset */
        }
        
        .print-section-box ul.print-note li {
            margin-bottom: 0; /* rely on row-gap for consistent vertical rhythm between rows */
            line-height: 1.65; /* lehce vyšší řádkování v tiskové verzi pro lepší čitelnost odstavců doplňujících informací */
        }

        .print-section-box ul.print-note li::marker {
            color: #CDE2B8;
        }

        #printDiscountNote {
            font-style: italic;
            color: #8A8F8D;
        }

        .print-summary-footer {
            margin-top: 44px; /* o ~8 px větší vzdálenost od doplňujících informací pro lepší optické vyvážení spodní části stránky */
            padding: 0 12px;
            background-color: transparent;
            color: #7D7D7D;
            font-size: 11px;
            line-height: 1.5;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            height: auto;
        }

        /* Datum výpočtu ve stejné vizuální úrovni jako zbytek řádku */
        .print-summary-footer #printDate {
            font-size: 11px;
            font-weight: 400;
        }

        @media (max-width: 768px) {
            .supplementary-info-columns {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        .category-note,
        .result-note {
            line-height: 1.6;
            color: #7D7D7D;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 20px;
                background: 
                    linear-gradient(90deg, rgba(185,207,0,0.08) 0%, transparent 100%),
                    linear-gradient(90deg, rgba(0,64,51,0.95) 0%, rgba(0,64,51,0.9) 50%, rgba(0,64,51,0.95) 100%),
                    url('images/direct-car-bg.jpg') center/cover no-repeat;
            }
            
            .header::before {
                background: rgba(0, 64, 51, 0.85);
            }

            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .logo img,
            .logo-img {
                height: 62.5px;
            }

            .header-nav {
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-link {
                font-size: 14px;
                padding: 8px 16px;
            }

            .main-content {
                padding: 30px 20px;
            }

            .form-container {
                padding: 25px;
            }

            .footer {
                padding: 24px 20px;
            }

            .footer-content {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }

            .footer-left {
                text-align: left;
            }

            .footer-right {
                text-align: left;
            }


            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            @page {
                size: A4;
                margin: 17mm 15mm 17mm 15mm;
            }

            *,
            *::before,
            *::after {
                box-shadow: none !important;
                text-shadow: none !important;
                background-image: none !important;
            }

            html,
            body {
                height: auto !important;
            }

            body {
                background-color: #ffffff !important;
                color: #004734 !important;
                font-family: 'Nunito Sans', 'DirectSans', sans-serif !important;
                font-size: 12px !important;
                line-height: 1.6 !important;
            }

            /* Slightly stronger weight for key numeric values in print to improve legibility on paper */
            .print-value {
                font-weight: 650 !important;
            }

            /* Skrýt webovou hlavičku, navigaci, patičku a interaktivní prvky */
            .header,
            .header-nav,
            .nav-link,
            .footer,
            .cta-button,
            .secondary-buttons,
            .btn-print,
            .btn-reset,
            #actionButtonsContainer,
            .autocomplete-dropdown,
            .date-icon,
            .calculation-message {
                display: none !important;
            }

            .main-content {
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                background-color: #ffffff !important;
            }

            .form-container {
                padding: 0 !important;
                margin: 0 !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                background: #ffffff !important;
            }

            /* Schovat samotný formulář a neveřejné boxy v tisku */
            #calculationForm,
            .form-section,
            .results-section,
            #damagedVehicleCategorySection,
            .footer-text,
            .doplnujici-info,
            .print-logo-header {
                display: none !important;
            }

            /* Hide main on-page title so only the print header title is visible */
            .page-title {
                display: none !important;
            }

            /* Zobrazit čistý tiskový souhrn */
            #printSummary {
                display: block !important;
            }

            .supplementary-info-columns,
            .supplementary-info-column,
            .supplementary-info-column li {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #004033 !important;
            }

            /* Webová patička se v tisku nezobrazuje */
            .footer {
                display: none !important;
            }

            /* Zjemnění vzhledu formulářových polí pro tisk */
            input,
            select,
            textarea {
                border: 0.5pt solid #004033 !important;
                padding: 2pt 4pt !important;
                border-radius: 0 !important;
                background: transparent !important;
                box-shadow: none !important;
            }
        }

        /* ======== MICROTYPE & INTERACTION POLISH ======== */

        /* 1️⃣ Typografie */
        h1, h2 {
            color: var(--brand-green);
            font-weight: 700;
            letter-spacing: 0.2px;
        }

        /* Hlavičky sekcí */
        h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #004033;
        }

        p {
            font-size: 16px;
            line-height: 1.6;
        }

        li {
            line-height: 1.6;
            font-size: 15px;
        }

        /* 2️⃣ Zvýrazněné hodnoty */
        .price-value {
            font-weight: 700;
            color: var(--brand-green);
        }

        /* 3️⃣ Jemný gradient u sekcí */
        .section-background {
            background: linear-gradient(180deg, #FAFCEB 0%, #F9FCE1 100%);
        }

        /* 4️⃣ Hover efekty – elegantní, neagresivní */
        button:hover, .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 64, 51, 0.2);
            transition: 0.2s ease;
        }

        /* 5️⃣ Spacing a kontrast mezi boxy */
        section + section {
            margin-top: 40px;
        }

        /* 6️⃣ Aktivní záložka – lepší čitelnost */
        /* Sjednoceno s hlavní definicí výše */

        /* 7️⃣ Tooltip / nápovědy */
        .tooltip {
            background: #004033;
            color: #FFFFFF;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="Loga/Logo+negativni+RGB.png" alt="Direct pojišťovna" class="logo-img">
            </a>
            <nav class="header-nav">
                <a href="index.html" class="nav-link">Ceník vozidel</a>
                <a href="vypocet.html" class="nav-link active">Výpočet půjčovného</a>
                <a href="servisy.html" class="nav-link">Smluvní servisy</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="form-container">
            <!-- Print Logo Header (hidden on screen, visible in print) -->
            <div class="print-logo-header" style="display: none;">
                <img src="Loga/Logo+pozitivní+RGB.png" alt="Direct pojišťovna">
            </div>
            
            <h1 class="page-title">Výpočet půjčovného za náhradní vozidlo</h1>

            <form id="calculationForm">
                <!-- Poškozené vozidlo -->
                <div class="form-section" id="damagedVehicleSection">
                    <h2 class="section-title">Poškozené vozidlo</h2>
                    <div class="form-row">
                        <div class="form-group autocomplete-select">
                            <label>Rok uvedení do provozu <span class="info-icon" data-tooltip="U vozidel starších než 8 let se sazba automaticky snižuje o 20 %.">ℹ️</span></label>
                            <div class="autocomplete-input-wrapper">
                                <input type="text" id="rokProvozu" placeholder="Vyberte rok" autocomplete="off" required>
                            </div>
                            <div class="autocomplete-dropdown" id="rokProvozuDropdown"></div>
                        </div>
                        <div class="form-group autocomplete-select">
                            <label>Značka</label>
                            <div class="autocomplete-input-wrapper">
                                <input type="text" id="znackaPoskozene" placeholder="Vyberte značku" autocomplete="off">
                            </div>
                            <div class="autocomplete-dropdown" id="znackaPoskozeneDropdown"></div>
                        </div>
                        <div class="form-group autocomplete-select">
                            <label>Model</label>
                            <div class="autocomplete-input-wrapper">
                                <input type="text" id="modelPoskozene" placeholder="Vyberte model" autocomplete="off">
                            </div>
                            <div class="autocomplete-dropdown" id="modelPoskozeneDropdown"></div>
                        </div>
                    </div>
                </div>

                <!-- Mezikrok - Nárokovaná kategorie poškozeného vozidla -->
                <div class="form-section" id="damagedVehicleCategorySection" style="display: none;">
                    <h2 class="section-title" style="display: none;"></h2>
                    <p class="category-result-intro">Podle zadaných údajů odpovídá vašemu vozidlu tato kategorie náhradního vozidla.<br>Uvedené ceny jsou maximální denní sazby, které vám uhradíme. Ceny jsou bez DPH a bez odpočtu pevných nákladů.</p>
                    <div id="damagedVehicleCategoryContent">
                        <div class="category-info">
                            <div class="category-name class-box" id="damagedCategoryName"></div>
                            <div class="category-note" id="damagedCategoryNote"></div>
                        </div>
                        <div class="category-rates">
                            <div class="rate-item">
                                <span class="rate-label">Cena za 1 den zapůjčení při době pronájmu do 10 dnů:</span>
                                <span class="rate-value" id="damagedRate1_10"></span>
                            </div>
                            <div class="rate-item">
                                <span class="rate-label">Cena za 1 den zapůjčení při době pronájmu 11–30 dnů:</span>
                                <span class="rate-value" id="damagedRate11_30"></span>
                            </div>
                        </div>
                        <div class="category-models-summary" id="categoryModelsSummary">
                            <h3 class="models-category-title">Modely v této kategorii</h3>
                            <p class="models-category-description">Níže uvedené vozy spadají do této kategorie vozidel podle platného ceníku.</p>
                            <p class="models-summary-text"></p>
                        </div>
                    </div>
                    
                    <!-- Buttons moved to below "Přepočítat" button -->
                </div>

                <!-- Pronajímané vozidlo -->
                <div class="form-section rental-vehicle-section">
                    <h2 class="section-title">Pronajímané vozidlo</h2>
                    <div class="form-row">
                        <div class="form-group autocomplete-select">
                            <label>Značka</label>
                            <div class="autocomplete-input-wrapper">
                                <input type="text" id="znackaPronajmene" placeholder="Vyberte značku" autocomplete="off">
                            </div>
                            <div class="autocomplete-dropdown" id="znackaPronajmeneDropdown"></div>
                        </div>
                        <div class="form-group autocomplete-select">
                            <label>Model</label>
                            <div class="autocomplete-input-wrapper">
                                <input type="text" id="modelPronajmene" placeholder="Vyberte model" autocomplete="off">
                            </div>
                            <div class="autocomplete-dropdown" id="modelPronajmeneDropdown"></div>
                        </div>
                    </div>
                    
                    <!-- Buttons moved to below "Přepočítat" button -->
                </div>

                <!-- Results -->
                <div class="results-section" id="resultsSection" style="display: none;">
                    <div id="calculationMessage" class="calculation-message" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true">
                        ✅ Hotovo! Sazba přepočtena.
                    </div>
                    <p class="rental-vehicle-intro" id="rentalVehicleIntroText" style="display: none;">Uvedená sazba je maximální výše, kterou vám uhradíme za každý den zapůjčení tohoto vozidla.</p>
                    <div class="result-row">
                        <div class="result-label-wrapper">
                            <span class="result-label">Cena za 1 den zapůjčení při době pronájmu do 10 dnů</span>
                        </div>
                        <div class="result-value-wrapper">
                            <span class="result-value" id="cenaDo14">-</span>
                            <span class="result-note" id="noteDo14"></span>
                        </div>
                    </div>
                    <div class="result-row">
                        <div class="result-label-wrapper">
                            <span class="result-label">Cena za 1 den zapůjčení při době pronájmu 11–30 dnů</span>
                        </div>
                        <div class="result-value-wrapper">
                            <span class="result-value" id="cenaNad14">-</span>
                            <span class="result-note" id="noteNad14"></span>
                        </div>
                    </div>
                    <p class="discount-info" id="discountInfo" style="display: none;">Sazba byla snížena o 20 % z důvodu stáří poškozeného vozidla (více než 8 let).</p>
                </div>
                
                <button type="button" class="cta-button" id="calculateBtn">Přepočítat</button>
                
                <!-- Print and Reset Buttons (shown dynamically based on form state) -->
                <div id="actionButtonsContainer" class="secondary-buttons" style="margin-top: 24px; display: none; justify-content: center; align-items: center; flex-direction: row;">
                    <button type="button" class="btn-print" id="printBtn" onclick="window.print()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px; vertical-align: middle;">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        Tisk do PDF
                    </button>
                    <button type="button" class="btn-reset" id="resetBtn" onclick="resetCalculation()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px; vertical-align: middle;">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        Nový výpočet
                    </button>
                </div>
            </form>

            <div class="footer-text doplnujici-info">
                <h3>Doplňující informace</h3>
                <div class="supplementary-info-columns">
                    <div class="supplementary-info-column">
                        <ul>
                            <li>Všechny denní sazby jsou uvedeny v Kč bez DPH a nebudou u nich odečítány pevné náklady.</li>
                            <li>Denní sazby ostatních vozidel budou posuzovány individuálně.</li>
                        </ul>
                    </div>
                    <div class="supplementary-info-column">
                        <ul>
                            <li>Při stáří poškozeného vozidla nad 8 let bude denní sazba snížena o 20 %.</li>
                            <li>Pro sazby půjčovného nad 30 dní je nutná konzultace s likvidátorem dané škodní události.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Clean print summary layout (visible only in print) -->
            <div id="printSummary" class="print-summary">
                <div class="print-summary-inner">
                    <div class="print-summary-header">
                        <div class="print-header-top">
                            <div class="print-logo-mini">
                                <img src="Loga/Logo+pozitivní+RGB.png" alt="Direct pojišťovna">
                            </div>
                        </div>
                        <div class="print-summary-title">Výpočet půjčovného za náhradní vozidlo</div>
                    </div>

                    <div class="print-section-box">
                        <h2>Poškozené vozidlo</h2>
                        <div class="print-row">
                            <span class="print-label">Rok uvedení do provozu</span>
                            <span class="print-value" id="printDamagedYear">-</span>
                        </div>
                        <div class="print-row">
                            <span class="print-label">Značka</span>
                            <span class="print-value" id="printDamagedBrand">-</span>
                        </div>
                        <div class="print-row">
                            <span class="print-label">Model</span>
                            <span class="print-value" id="printDamagedModel">-</span>
                        </div>
                        <div class="print-row">
                            <span class="print-label">Kategorie náhradního vozidla</span>
                            <span class="print-value" id="printDamagedCategory">-</span>
                        </div>
                        <p class="print-note" id="printDamagedCategoryNote" style="display: none;"></p>
                    </div>

                    <div class="print-section-box print-section-box-highlight">
                        <h2>Výsledná sazba</h2>
                        <div class="print-rate-table">
                            <div class="print-row">
                                <span class="print-label">Cena za 1 den zapůjčení při době pronájmu do 10 dnů</span>
                                <span class="print-value" id="printPrice1_10">-</span>
                            </div>
                            <div class="print-row">
                                <span class="print-label">Cena za 1 den zapůjčení při době pronájmu 11–30 dnů</span>
                                <span class="print-value" id="printPrice11_30">-</span>
                            </div>
                        </div>
                        <p class="print-note" id="printPriceNote"></p>
                        <p class="print-note">Uvedené sazby jsou v Kč bez DPH a nebudou u nich odečítány pevné náklady.</p>
                        <p class="print-note" id="printDiscountNote" style="display: none;">Sazba byla snížena o 20 % z důvodu stáří poškozeného vozidla (více než 8 let).</p>
                    </div>

                    <!-- Modely v této kategorii – tisková verze -->
                    <div class="print-section-box print-section-box-highlight print-section-box-models" id="printCategoryModelsBox" style="display: none;">
                        <h2 class="print-models-title">Modely v této kategorii</h2>
                        <p class="print-models-description">Níže uvedené vozy spadají do této kategorie vozidel podle platného ceníku.</p>
                        <p class="print-models-summary" id="printCategoryModelsText"></p>
                    </div>

                    <div class="print-section-box">
                        <h2>Pronajímané vozidlo</h2>
                        <div class="print-row">
                            <span class="print-label">Značka</span>
                            <span class="print-value" id="printRentalBrand">-</span>
                        </div>
                        <div class="print-row">
                            <span class="print-label">Model</span>
                            <span class="print-value" id="printRentalModel">-</span>
                        </div>
                    </div>

                    <div class="print-section-box print-section-box-highlight print-section-box-rental-rate">
                        <h2>Výsledná sazba pronajímaného vozidla</h2>
                        <div class="print-rate-table">
                            <div class="print-row">
                                <span class="print-label">Cena za 1 den zapůjčení při době pronájmu do 10 dnů</span>
                                <span class="print-value" id="printRentalPrice1_10">-</span>
                            </div>
                            <div class="print-row">
                                <span class="print-label">Cena za 1 den zapůjčení při době pronájmu 11–30 dnů</span>
                                <span class="print-value" id="printRentalPrice11_30">-</span>
                            </div>
                        </div>
                        <p class="print-note">Uvedená sazba je maximální výše, kterou vám uhradíme za každý den zapůjčení tohoto vozidla.</p>
                    </div>

                    <div class="print-section-box">
                        <h2>Doplňující informace</h2>
                        <ul class="print-note">
                            <li>Všechny denní sazby jsou uvedeny v Kč bez DPH a nebudou u nich odečítány pevné náklady.</li>
                            <li>Denní sazby ostatních vozidel budou posuzovány individuálně.</li>
                            <li>Při stáří poškozeného vozidla nad 8 let bude denní sazba snížena o 20 %.</li>
                            <li>Pro sazby půjčovného nad 30 dní je nutná konzultace s likvidátorem dané škodní události.</li>
                        </ul>
                    </div>

                    <div class="print-summary-footer">
                        Direct pojišťovna a.s.&nbsp;•&nbsp;info@direct.cz&nbsp;•&nbsp;www.direct.cz&nbsp;•&nbsp;+420 270 270 777&nbsp;•&nbsp;Datum výpočtu:&nbsp;<span id="printDate"></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <a href="https://www.direct.cz" target="_blank" rel="noopener noreferrer">direct.cz</a>
                <span>221 221 221</span>
            </div>
            <div class="footer-right">
                <p>Direct pojišťovna, a.s., se sídlem Nové sady 996/25, Brno, 602 00, IČO: 250 739 58, DIČ: CZ 699 004 195,<br>
                zapsaná v obchodním rejstříku krajského soudu v Brně, oddíl B, vložka 3365.</p>
            </div>
        </div>
    </footer>

    <script>
        // Header scroll shadow effect
        window.addEventListener('scroll', function() {
            if (window.scrollY > 10) {
                document.body.classList.add('scrolled');
            } else {
                document.body.classList.remove('scrolled');
            }
        });
        
        // Data from price list
        const cenÝkData = [
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Citigo",
            "cena_1_10_dni": 500,
            "cena_11_30_dni": 400
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Fabia + Roomster",
            "cena_1_10_dni": 600,
            "cena_11_30_dni": 480
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Rapid",
            "cena_1_10_dni": 650,
            "cena_11_30_dni": 520
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Scala + Kamiq + Yeti",
            "cena_1_10_dni": 750,
            "cena_11_30_dni": 600
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Octavia I + II",
            "cena_1_10_dni": 600,
            "cena_11_30_dni": 480
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Octavia III + IV",
            "cena_1_10_dni": 1000,
            "cena_11_30_dni": 800
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Karoq + Elroq",
            "cena_1_10_dni": 1100,
            "cena_11_30_dni": 880
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Superb",
            "cena_1_10_dni": 1200,
            "cena_11_30_dni": 960
          },
          {
            "kategorie": "vozy Škoda",
            "znacka_typ": "Kodiaq + Enyaq",
            "cena_1_10_dni": 1350,
            "cena_11_30_dni": 1080
          },
          {
            "kategorie": "Mini",
            "znacka_typ": "Citroën C1, Fiat 500 + Panda, Ford KA, Hyundai i10, Chevrolet Spark, Kia Picanto, Opel Adam + Agila, Peugeot 107 + 108, Renault Twingo, Seat Mii, Smart Fortwo, Suzuki Alto + Celerio + Splash, Toyota Aygo, Volkswagen UP!",
            "cena_1_10_dni": 550,
            "cena_11_30_dni": 440
          },
          {
            "kategorie": "Malá ",
            "znacka_typ": "Alfa Romeo MiTo, Citroën C3, DS 3, Fiat Punto, Ford Fiesta + Fusion, Honda Jazz, Hyundai i20 + Getz, Chevrolet Aveo + Kalos, Kia Rio + Soul, Mazda 2, Mitsubishi Colt, Nissan Micra, Opel Corsa, Peugeot 206 + 207 + 208, Renault Clio + Thalia, Seat Cordoba + Ibiza, Subaru Justy, Smart ForFour, Suzuki Swift, Toyota Yaris, Volkswagen Polo, Dacia Sandero + Logan",
            "cena_1_10_dni": 700,
            "cena_11_30_dni": 560
          },
          {
            "kategorie": "Malá premium",
            "znacka_typ": "Audi A1, Mini Cooper",
            "cena_1_10_dni": 900,
            "cena_11_30_dni": 720
          },
          {
            "kategorie": "Nižší střední",
            "znacka_typ": "Alfa Romeo 147 + Giulietta, Fiat Bravo + Tipo, Citroën C4 + C-Elysée, Cupra Leon, DS 4, Ford Focus, Honda Civic, Hyundai Accent + Elantra + i30, Chevrolet Cruze, Kia Ceed, Mazda 3, Mitsubishi Lancer, Nissan Almera, Opel Astra, Peugeot 301 + 307 + 308, Renault Megane + Fluence, Seat Leon + Toledo, Subaru Impreza, Toyota Auris + Corolla + Prius, Volvo C30 + V40, Volkswagen Golf + New Beetle",
            "cena_1_10_dni": 900,
            "cena_11_30_dni": 720
          },
          {
            "kategorie": "Nižší střední premium",
            "znacka_typ": "Audi A3, BMW 1 + 2, Mercedes-Benz A, Lexus CT, Mini Clubman",
            "cena_1_10_dni": 1200,
            "cena_11_30_dni": 960
          },
          {
            "kategorie": "Střední",
            "znacka_typ": "Alfa Romeo 159 + Giulia, Citroën C5, Dodge Caliber, Fiat Croma, Ford Mondeo, Hyundai i40 + Sonata, Kia Optima,\nMazda 6, Opel Insignia + Vectra, Peugeot 406 + 407 + 508, Renault Talisman + Laguna, Seat Exeo, Subaru Legacy + Levorg, Toyota Avensis + Camry, Volkswagen Passat + CC, Tesla Model 3",
            "cena_1_10_dni": 1200,
            "cena_11_30_dni": 960
          },
          {
            "kategorie": "Střední premium",
            "znacka_typ": "Audi A4 + A5, BMW 3 + 4, Jaguar XE, Mercedes-Benz C + CLA, Lexus IS, Volvo S60 + V60 + V70, Hyundai IONIQ 5 + 6",
            "cena_1_10_dni": 1500,
            "cena_11_30_dni": 1200
          },
          {
            "kategorie": "Vyšší střední",
            "znacka_typ": "Citroën C6, DS 9, Honda Legend, Hyundai Genesis, Peugeot 607,",
            "cena_1_10_dni": 1500,
            "cena_11_30_dni": 1200
          },
          {
            "kategorie": "Vyšší střední premium",
            "znacka_typ": "Audi A6 + A7, BMW 5 + 6, Jaguar XF, Maserati Ghibli, Mercedes-Benz E + CLS, Volvo S90 + V90, Volkswagen Arteon,",
            "cena_1_10_dni": 2100,
            "cena_11_30_dni": 1680
          },
          {
            "kategorie": "Luxusní",
            "znacka_typ": "Audi A8, BMW 7 + 8, Jaguar XJ + XK, Lexus LS, Mercedes-Benz S, Porsche Panamera, Volkswagen Phaeton, Tesla Model S",
            "cena_1_10_dni": 2800,
            "cena_11_30_dni": 2240
          },
          {
            "kategorie": "MPV malá",
            "znacka_typ": "Citroën C3 Picasso, Fiat 500L + Qubo, Ford B-MAX + C-MAX, Hyundai ix20, Kia Venga, Opel Meriva, Renault Kangoo, Toyota Urban Cruiser, Dacia Jogger + Logan MCV,",
            "cena_1_10_dni": 800,
            "cena_11_30_dni": 640
          },
          {
            "kategorie": "MPV střední",
            "znacka_typ": "Citroën C4 SpaceTourer + Grand Picasso + C4 Picasso + Xsara Picasso + Berlingo, Ford Grand C-max, Chevrolet Orlando, Mazda 5, Opel Zafira, Peugeot Rifter, Renault Scénic + Grand Scénic, Seat Altea, Toyota Verso, Volkswagen Golf Sports VAN + Touran + Caddy, BMW 2 Tourer, Mercedes-Benz B + Citan, Fiat Doblo",
            "cena_1_10_dni": 1000,
            "cena_11_30_dni": 800
          },
          {
            "kategorie": "MPV velká",
            "znacka_typ": "Citroën Jumpy + C8, Ford S-MAX + Galaxy, Mercedes-Benz Viano, Peugeot 807, Renault Espace, Seat Alhambra, Volkswagen Sharan, Chrysler Voyager, Peugeot Expert",
            "cena_1_10_dni": 1400,
            "cena_11_30_dni": 1120
          },
          {
            "kategorie": "SUV malé ",
            "znacka_typ": "Baic X3, Dacia Duster + Bigster, SsangYong (KGM) Tivoli + Korando, MG ZS, Citroën C3 Aircross + C4 Aircross + Cactus, DS 3 Crossback, Fiat 500X, Ford Ecosport, Honda HRV, Hyundai Bayon + Kona, Jeep Renegade, Kia XCeed + Soul + Stonic + Niro, Mazda CX-3, Mitsubishi ASX, Nissan Juke, Opel Crossland X + Mokka, Peugeot 2008, Renault Captur + Arkana, Seat Arona + Ateca, Cupra Ateca, Suzuki Jimny + SX4 + S-Cross + Vitara,  Toyota C-HR + Yaris Cross, Volkswagen Taigo + T-Cross + T-Roc",
            "cena_1_10_dni": 850,
            "cena_11_30_dni": 680
          },
          {
            "kategorie": "SUV malé premium ",
            "znacka_typ": "Mercedes-Benz GLA, Volvo XC40, Baic X5",
            "cena_1_10_dni": 1200,
            "cena_11_30_dni": 960
          },
          {
            "kategorie": "SUV střední ",
            "znacka_typ": "Alfa Romeo Stelvio + Tonale, Baic X7, SsangYong (KGM) Torres, MG HS + EHS (hybrid), Citroën C-Crosser, Cupra Formentor, DS 7, Fiat Freemont, Ford Edge + Kuga, Honda CR-V, Hyundai ix35 + Tucson, Chevrolet Captiva, Jeep Compass + Cherokee, Kia Sportage + EV3, Mazda CX-5 + CX30, Mitsubishi Eclipse + Outlander, Nissan Qashqai, Opel Grandland X, Peugeot 3008 + 5008, Renault Austral + Koleos + Kadjar + Rafale, Seat Tarraco, Subaru Forester + XV, Suzuki Grand Vitara, Toyota RAV4, Volkswagen Tiguan, Jaecoo 7",
            "cena_1_10_dni": 1350,
            "cena_11_30_dni": 1080
          },
          {
            "kategorie": "SUV střední premium",
            "znacka_typ": "Audi Q2 + Q3, BMW X1 + X2, Land Rover Range Rover Evoque + Defender, Mercedes-Benz ML + GLB, Porsche Macan, Volvo XC60 + XC70, Tesla Model Y, Leapmotor C10",
            "cena_1_10_dni": 1500,
            "cena_11_30_dni": 1200
          },
          {
            "kategorie": "SUV velké ",
            "znacka_typ": "Ford Explorer, Hyundai Santa-Fe, Jeep Wrangler, Nissan Pathfinder + Patrol, Mitsubishi Pajero, Nissan X-Trail, Toyota Highlander, SsangYong (KGM) Rexton, Kia EV6 + Sorento",
            "cena_1_10_dni": 1800,
            "cena_11_30_dni": 1440
          },
          {
            "kategorie": "SUV velké premium",
            "znacka_typ": "Audi Q5, BMW X3 + X4, Jeep Grand Cherokee, Land Rover Discovery + Range Rover Velar, Mercedes-Benz GLC, Volvo XC90, Volkswagen Touareg, Lexus RX, Kia EV9",
            "cena_1_10_dni": 2300,
            "cena_11_30_dni": 1840
          },
          {
            "kategorie": "Luxusní SUV",
            "znacka_typ": "Audi Q7 + Q8, BMW X5 + X6 + X7, Infiniti FX, Land Rover Range Rover, Mercedes-Benz G + GL + GLE + GLS, Porsche Cayenne, Toyota Land Cruiser, Tesla Model X, Hyundai IONIQ 9",
            "cena_1_10_dni": 2750,
            "cena_11_30_dni": 2200
          },
          {
            "kategorie": "Užitková malá",
            "znacka_typ": "Citroën Berlingo + Nemo, Dacia Dokker + Lodgy, Fiat Doblo + Fiorino, Ford Transit Connect, Opel Combo, Peugeot Bipper + Partner + Rifter, Renault Kangoo, Volkswagen Caddy",
            "cena_1_10_dni": 800,
            "cena_11_30_dni": 640
          },
          {
            "kategorie": "Užitková střední",
            "znacka_typ": "Citroën Jumpy, Fiat Talento, Ford Transit Custom, Hyundai H-1 Van, Mercedes-Benz Vito, Nissan NV200, Opel Vivaro, Peugeot Expert, Renault Trafic, Volkswagen Transporter, Kia PV5 Cargo,",
            "cena_1_10_dni": 1000,
            "cena_11_30_dni": 800
          },
          {
            "kategorie": "Užitková velká",
            "znacka_typ": "Citroën Jumper, Fiat Ducato, Ford Transit, Hyundai H350, Iveco Daily, Mercedes-Benz Sprinter, Opel Movano, Peugeot Boxer, Renault Master, Volkswagen Crafter",
            "cena_1_10_dni": 1200,
            "cena_11_30_dni": 960
          },
          {
            "kategorie": "Pick - up",
            "znacka_typ": "Ford Ranger, Isuzu D-Max, Mazda BT, Mitsubishi L200, Mercedes-Benz X, Nissan Navara + NP300, Toyota Hilux, Volkswagen Amarok, Tesla Cybertruck, SsangYong (KGM) Musso",
            "cena_1_10_dni": 1500,
            "cena_11_30_dni": 1200
          },
          {
            "kategorie": "Mikrobus",
            "znacka_typ": "Citroën Spacetourer + Jumper Bus, Fiat Ducato Minibus, Mercedes-Benz Vito + V, Peugeot Traveller, Volkswagen California + Caravelle + Crafter + Multivan, Hyundai Staria, Toyota Proace Verso, Kia PV5 Passenger",
            "cena_1_10_dni": 1500,
            "cena_11_30_dni": 1200
          }
        ];

        // Vehicle brands list
        const vehicleBrands = [
            'Alfa Romeo', 'Audi', 'Baic', 'BMW', 'Chevrolet', 'Chrysler', 'Citroën', 'Cupra', 
            'Dacia', 'Dodge', 'DS', 'Fiat', 'Ford', 'Honda', 'Hyundai', 'Infiniti', 'Isuzu', 
            'Iveco', 'Jaguar', 'Jaecoo', 'Jeep', 'Kia', 'Land Rover', 'Leapmotor', 'Lexus', 'Maserati', 'Mazda', 
            'Mercedes-Benz', 'MG', 'Mini', 'Mitsubishi', 'Nissan', 'Opel', 'Peugeot', 'Porsche', 
            'Renault', 'Seat', 'Škoda', 'Smart', 'SsangYong', 'Subaru', 'Suzuki', 'Tesla', 
            'Toyota', 'Volkswagen', 'Volvo'
        ];

        // Extract unique models and categories, and create brand-to-models mapping
        function extractBrandsAndModels() {
            const models = new Set();
            const categories = new Set();
            const brandToModels = {}; // Map brand -> Set of models
            const extractedBrands = new Set(); // Track all brands found in data

            // Initialize brand maps with known brands
            vehicleBrands.forEach(brand => {
                brandToModels[brand] = new Set();
            });

            // Helper function to normalize brand name (handle variations like Mercedes-Benz vs Mercedes Benz)
            function normalizeBrand(brandName) {
                // Replace common variations
                return brandName
                    .replace(/-/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            // Helper function to find matching brand (case-insensitive, handles variations)
            function findMatchingBrand(part) {
                const partLower = part.toLowerCase();
                
                // Try exact match first
                for (const brand of vehicleBrands) {
                    const brandLower = brand.toLowerCase();
                    const brandNormalized = normalizeBrand(brand).toLowerCase();
                    const partNormalized = normalizeBrand(part).toLowerCase();
                    
                    // Check if part starts with brand name (with space after)
                    if (partLower.startsWith(brandLower + ' ') || 
                        partNormalized.startsWith(brandNormalized + ' ') ||
                        partLower === brandLower) {
                        return brand;
                    }
                }
                
                // If no exact match, try to extract brand from beginning of part
                // Look for known brand patterns at the start
                for (const brand of vehicleBrands) {
                    const brandLower = brand.toLowerCase();
                    const brandWords = brandLower.split(/\s+/);
                    const partWords = partLower.split(/\s+/);
                    
                    // Check if first word(s) match brand
                    let matches = true;
                    for (let i = 0; i < brandWords.length && i < partWords.length; i++) {
                        if (partWords[i] !== brandWords[i]) {
                            matches = false;
                            break;
                        }
                    }
                    
                    if (matches && partWords.length > brandWords.length) {
                        // Check if next word is not a brand (it should be a model)
                        return brand;
                    }
                }
                
                return null;
            }

            cenÝkData.forEach(item => {
                if (item.kategorie) categories.add(item.kategorie);
                
                const znackaTyp = item.znacka_typ;
                
                // Special handling for "vozy Škoda" category
                if (item.kategorie && item.kategorie.toLowerCase().includes('škoda')) {
                    // For Škoda, znacka_typ contains only models (e.g., "Citigo", "Fabia + Roomster", "Octavia I + II", "Octavia III + IV")
                    
                    // First check if the entire string is a version pattern like "Octavia I + II" or "Octavia III + IV"
                    const fullVersionPattern = /^([A-Za-z\s]+)\s+([IVX]+)\s*\+\s*([IVX]+)$/i;
                    const fullVersionMatch = znackaTyp.match(fullVersionPattern);
                    
                    if (fullVersionMatch) {
                        // It's a full version pattern like "Octavia I + II" or "Octavia III + IV"
                        // Extract both versions: "Octavia I" and "Octavia II"
                        const baseModel = fullVersionMatch[1].trim();
                        const version1 = fullVersionMatch[2].trim();
                        const version2 = fullVersionMatch[3].trim();
                        
                        if (baseModel && baseModel.length > 0 && baseModel.length < 30) {
                            // Add both versions
                            const model1 = (baseModel + ' ' + version1).trim();
                            const model2 = (baseModel + ' ' + version2).trim();
                            
                            if (model1.length > 0 && model1.length < 30) {
                                models.add(model1);
                                brandToModels['Škoda'].add(model1);
                            }
                            if (model2.length > 0 && model2.length < 30) {
                                models.add(model2);
                                brandToModels['Škoda'].add(model2);
                            }
                        }
                    } else {
                        // Regular models separated by + (e.g., "Fabia + Roomster", "Scala + Kamiq + Yeti")
                        const skodaModels = znackaTyp.split('+').map(m => m.trim());
                        skodaModels.forEach(model => {
                            if (model && model.length > 0) {
                                // Check if it's a single version like "Octavia II" or "Octavia IV"
                                // Pattern: word(s) followed by space and roman numeral
                                const singleVersionPattern = /^([A-Za-z\s]+)\s+([IVX]+)$/i;
                                const singleVersionMatch = model.match(singleVersionPattern);
                                
                                if (singleVersionMatch) {
                                    // It's a single version like "Octavia II" - keep full name
                                    const fullModel = model.trim();
                                    if (fullModel && fullModel.length > 0 && fullModel.length < 30) {
                                        models.add(fullModel);
                                        brandToModels['Škoda'].add(fullModel);
                                    }
                                } else {
                                    // Regular model name (e.g., "Citigo", "Fabia", "Roomster")
                                    // But skip if it's just a roman numeral (I, II, III, IV, etc.)
                                    const isRomanNumeral = /^[IVX]+$/i.test(model.trim());
                                    if (!isRomanNumeral) {
                                        const cleanModel = model.trim();
                                        if (cleanModel && cleanModel.length > 0 && cleanModel.length < 30) {
                                            models.add(cleanModel);
                                            brandToModels['Škoda'].add(cleanModel);
                                        }
                                    }
                                }
                            }
                        });
                    }
                } else {
                    // For other categories, znacka_typ contains "Brand Model" format
                    // Split by comma to get individual entries (e.g., "Audi Q5, BMW X3 + X4")
                    const parts = znackaTyp.split(',');
                    
                    parts.forEach(part => {
                        part = part.trim();
                        if (!part || part.length === 0) return;
                        
                        // Find matching brand
                        const matchedBrand = findMatchingBrand(part);
                        
                        if (matchedBrand) {
                            extractedBrands.add(matchedBrand);
                            
                            // Initialize brand map if not exists
                            if (!brandToModels[matchedBrand]) {
                                brandToModels[matchedBrand] = new Set();
                            }
                            
                            // Extract models after brand name
                            // Find where brand name ends in the part
                            const brandLower = matchedBrand.toLowerCase();
                            const partLower = part.toLowerCase();
                            let brandEndIndex = matchedBrand.length;
                            
                            // Try to find exact match position
                            if (partLower.startsWith(brandLower + ' ')) {
                                brandEndIndex = matchedBrand.length;
                            } else {
                                // Try normalized match (handle Mercedes-Benz vs Mercedes Benz)
                                const normalizedBrand = normalizeBrand(matchedBrand).toLowerCase();
                                const normalizedPart = normalizeBrand(part).toLowerCase();
                                if (normalizedPart.startsWith(normalizedBrand + ' ')) {
                                    // Find actual position in original string
                                    // Count words in brand and find where they end in part
                                    const brandWords = matchedBrand.split(/\s+/);
                                    const partWords = part.split(/\s+/);
                                    let wordCount = 0;
                                    for (let i = 0; i < brandWords.length && i < partWords.length; i++) {
                                        if (normalizeBrand(partWords[i]).toLowerCase() === normalizeBrand(brandWords[i]).toLowerCase()) {
                                            wordCount++;
                                        } else {
                                            break;
                                        }
                                    }
                                    if (wordCount === brandWords.length) {
                                        // Calculate position after brand words
                                        brandEndIndex = 0;
                                        for (let i = 0; i < wordCount; i++) {
                                            brandEndIndex += partWords[i].length;
                                            if (i < wordCount - 1) brandEndIndex += 1; // space
                                        }
                                    }
                                } else {
                                    // Fallback: try to find brand by matching words
                                    const brandWords = matchedBrand.split(/\s+/);
                                    const partWords = part.split(/\s+/);
                                    let wordCount = 0;
                                    for (let i = 0; i < brandWords.length && i < partWords.length; i++) {
                                        const brandWordNorm = normalizeBrand(brandWords[i]).toLowerCase();
                                        const partWordNorm = normalizeBrand(partWords[i]).toLowerCase();
                                        if (partWordNorm === brandWordNorm) {
                                            wordCount++;
                                        } else {
                                            break;
                                        }
                                    }
                                    if (wordCount === brandWords.length) {
                                        // Calculate position after brand words
                                        brandEndIndex = 0;
                                        for (let i = 0; i < wordCount; i++) {
                                            brandEndIndex += partWords[i].length;
                                            if (i < wordCount - 1) brandEndIndex += 1; // space
                                        }
                                    }
                                }
                            }
                            
                            const afterBrand = part.substring(brandEndIndex).trim();
                            if (afterBrand && afterBrand.length > 0) {
                                // Split by + to get multiple models (e.g., "S60 + V60 + V70" or "IONIQ 5 + 6")
                                const modelParts = afterBrand.split('+');
                                let lastBase = '';

                                modelParts.forEach(modelPart => {
                                    modelPart = modelPart.trim();
                                    if (modelPart && modelPart.length > 0 && modelPart.length < 30) {
                                        // Clean model name - remove parentheses content, but keep the model name
                                        let cleanModel = modelPart.replace(/\s*\([^)]*\)/g, '').trim();
                                        // Remove trailing commas
                                        cleanModel = cleanModel.replace(/,\s*$/, '').trim();
                                        if (!cleanModel || cleanModel.length === 0) return;

                                        let finalModel = cleanModel;
                                        const isPureNumber = /^[0-9]+$/.test(cleanModel);

                                        // Pokud máme pattern typu "IONIQ 5 + 6", první část je "IONIQ 5"
                                        // → uložíme si základ "IONIQ" a druhou část "6" přepíšeme na "IONIQ 6"
                                        if (isPureNumber && lastBase) {
                                            finalModel = `${lastBase} ${cleanModel}`.trim();
                                        } else {
                                            // Pokud je to "<base> <číslo>", ulož základ pro další číselné části
                                            const baseCandidate = cleanModel.replace(/\s*\d+$/, '').trim();
                                            if (baseCandidate && baseCandidate !== cleanModel) {
                                                lastBase = baseCandidate;
                                            } else if (!isPureNumber) {
                                                // Jinak základ resetuj (aby se nepřenášel do nesouvisejících modelů)
                                                lastBase = '';
                                            }
                                        }

                                        if (finalModel && finalModel.length > 0 && finalModel.length < 30) {
                                            models.add(finalModel);
                                            brandToModels[matchedBrand].add(finalModel);
                                        }
                                    }
                                });
                            }
                        }
                    });
                }
            });

            // Convert Sets to Arrays and sort
            const brandToModelsArray = {};
            Object.keys(brandToModels).forEach(brand => {
                brandToModelsArray[brand] = Array.from(brandToModels[brand])
                    .filter(m => m.length > 0 && m.length < 30)
                    .sort();
            });

            // Combine extracted brands with known brands, remove duplicates
            const allBrands = Array.from(new Set([...vehicleBrands, ...extractedBrands])).sort();

            return {
                brands: allBrands,
                models: Array.from(models).filter(m => m.length > 0 && m.length < 30).sort(),
                categories: Array.from(categories).sort(),
                brandToModels: brandToModelsArray
            };
        }

        // Autocomplete functionality
        function initAutocomplete(inputId, dropdownId, options, optionsGetter = null) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            const autocompleteGroup = input.closest('.form-group.autocomplete-select');
            let selectedIndex = -1;
            let currentOptions = options;
            let isSelectingFromDropdown = false;

            function setOpenState(isOpen) {
                if (!autocompleteGroup) return;
                autocompleteGroup.classList.toggle('open', isOpen);
            }

            // Function to update options dynamically
            function updateOptions(newOptions) {
                currentOptions = newOptions;
            }

            // Store update function on input element for external access
            input.updateAutocompleteOptions = updateOptions;

            function showOptions(filterValue = '') {
                // Use optionsGetter if provided (for dynamic options), otherwise use currentOptions
                const availableOptions = optionsGetter ? optionsGetter() : currentOptions;
                
                const filtered = filterValue 
                    ? availableOptions.filter(option => 
                        option.toLowerCase().startsWith(filterValue.toLowerCase())
                      )
                    : availableOptions;

                if (filtered.length === 0) {
                    dropdown.classList.remove('show');
                    setOpenState(false);
                    return;
                }

                dropdown.innerHTML = '';
                filtered.forEach((option, index) => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = option;
                    item.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    });
                    
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        // Mark that we're selecting from dropdown to prevent reopening
                        isSelectingFromDropdown = true;
                        
                        // Set value and close dropdown immediately
                        input.value = option;
                        dropdown.classList.remove('show');
                        setOpenState(false);
                        
                        // Use setTimeout to ensure dropdown is closed before focusing
                        setTimeout(() => {
                            // Trigger input event to enable model field if this is a brand input
                            const inputEvent = new Event('input', { bubbles: true });
                            input.dispatchEvent(inputEvent);
                            
                            // Reset flag after a short delay
                            setTimeout(() => {
                                isSelectingFromDropdown = false;
                            }, 100);
                        }, 10);
                        
                        return false;
                    });
                    dropdown.appendChild(item);
                });

                dropdown.classList.add('show');
                setOpenState(true);
                selectedIndex = -1;
            }

            // Show all options when input is focused (always show dropdown, even if value exists)
            input.addEventListener('focus', () => {
                // Don't show dropdown if we just selected from it
                if (!isSelectingFromDropdown) {
                    // Always show all options when focused, regardless of current value
                    showOptions('');
                }
            });

            // Filter options when typing
            input.addEventListener('input', (e) => {
                // Don't show dropdown if we just selected from it
                if (!isSelectingFromDropdown) {
                    showOptions(e.target.value);
                }
            });

            input.addEventListener('keydown', (e) => {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                    items.forEach((item, i) => {
                        item.classList.toggle('selected', i === selectedIndex);
                    });
                    // Scroll selected item into view
                    if (items[selectedIndex]) {
                        items[selectedIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    items.forEach((item, i) => {
                        item.classList.toggle('selected', i === selectedIndex);
                    });
                    // Scroll selected item into view
                    if (selectedIndex >= 0 && items[selectedIndex]) {
                        items[selectedIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    // If dropdown is open, select item (first one if none selected)
                    if (dropdown.classList.contains('show') && items.length > 0) {
                        const indexToSelect = selectedIndex >= 0 ? selectedIndex : 0;
                        if (items[indexToSelect]) {
                            // Mark that we're selecting from dropdown to prevent reopening
                            isSelectingFromDropdown = true;
                            
                            // Set value and close dropdown immediately
                            input.value = items[indexToSelect].textContent;
                            dropdown.classList.remove('show');
                            setOpenState(false);
                            
                            // Use setTimeout to ensure dropdown is closed before focusing
                            setTimeout(() => {
                                // Trigger input event to enable model field if this is a brand input
                                const inputEvent = new Event('input', { bubbles: true });
                                input.dispatchEvent(inputEvent);
                                
                                // Reset flag after a short delay
                                setTimeout(() => {
                                    isSelectingFromDropdown = false;
                                }, 100);
                            }, 10);
                        }
                    }
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    dropdown.classList.remove('show');
                    setOpenState(false);
                    selectedIndex = -1;
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                // Check if click is outside both input and dropdown
                const isClickInside = input.contains(e.target) || dropdown.contains(e.target);
                if (!isClickInside && dropdown.classList.contains('show')) {
                    // Use setTimeout to allow click handlers on items to execute first
                    setTimeout(() => {
                        if (dropdown.classList.contains('show')) {
                            dropdown.classList.remove('show');
                            setOpenState(false);
                        }
                    }, 0);
                }
            }, false);
        }

        // Generate years list from current year down to 1970
        function generateYears() {
            const currentYear = new Date().getFullYear();
            const years = [];
            for (let year = currentYear; year >= 1970; year--) {
                years.push(year.toString());
            }
            return years;
        }

        // Populate dropdowns
        function populateDropdowns() {
            const { brands, models, categories, brandToModels } = extractBrandsAndModels();
            const years = generateYears();

            // Initialize autocomplete for brand inputs
            initAutocomplete('znackaPoskozene', 'znackaPoskozeneDropdown', brands);
            initAutocomplete('znackaPronajmene', 'znackaPronajmeneDropdown', brands);

            // Initialize autocomplete for model inputs with dynamic options based on selected brand
            const modelPoskozeneInput = document.getElementById('modelPoskozene');
            const modelPronajmeneInput = document.getElementById('modelPronajmene');
            
            // Function to get models for "Poškozené vozidlo" based on selected brand
            function getModelsForPoskozene() {
                const selectedBrand = document.getElementById('znackaPoskozene').value.trim();
                if (!selectedBrand) return [];
                // Try to find matching brand (case-insensitive)
                const matchingBrand = brands.find(b => b.toLowerCase() === selectedBrand.toLowerCase());
                return matchingBrand && brandToModels[matchingBrand] ? brandToModels[matchingBrand] : [];
            }

            // Function to get models for "Pronajímané vozidlo" based on selected brand
            function getModelsForPronajmene() {
                const selectedBrand = document.getElementById('znackaPronajmene').value.trim();
                if (!selectedBrand) return [];
                // Try to find matching brand (case-insensitive)
                const matchingBrand = brands.find(b => b.toLowerCase() === selectedBrand.toLowerCase());
                return matchingBrand && brandToModels[matchingBrand] ? brandToModels[matchingBrand] : [];
            }

            initAutocomplete('modelPoskozene', 'modelPoskozeneDropdown', [], getModelsForPoskozene);
            initAutocomplete('modelPronajmene', 'modelPronajmeneDropdown', [], getModelsForPronajmene);

            // Initialize autocomplete for year input
            initAutocomplete('rokProvozu', 'rokProvozuDropdown', years);

            // Disable model inputs initially
            modelPoskozeneInput.disabled = true;
            modelPronajmeneInput.disabled = true;

            // Enable model input when brand is selected
            const znackaPoskozene = document.getElementById('znackaPoskozene');
            const znackaPronajmene = document.getElementById('znackaPronajmene');

            // Function to handle brand change for "Poškozené vozidlo"
            function handleBrandChangePoskozene() {
                const brandValue = znackaPoskozene.value.trim();
                const modelDropdown = document.getElementById('modelPoskozeneDropdown');
                
                if (brandValue !== '') {
                    modelPoskozeneInput.disabled = false;
                    modelPoskozeneInput.value = ''; // Clear model when brand changes
                    modelDropdown.classList.remove('show'); // Close model dropdown
                } else {
                    modelPoskozeneInput.disabled = true;
                    modelPoskozeneInput.value = '';
                    modelDropdown.classList.remove('show');
                }
            }

            // Function to handle brand change for "Pronajímané vozidlo"
            function handleBrandChangePronajmene() {
                const brandValue = znackaPronajmene.value.trim();
                const modelDropdown = document.getElementById('modelPronajmeneDropdown');
                
                if (brandValue !== '') {
                    modelPronajmeneInput.disabled = false;
                    modelPronajmeneInput.value = ''; // Clear model when brand changes
                    modelDropdown.classList.remove('show'); // Close model dropdown
                } else {
                    modelPronajmeneInput.disabled = true;
                    modelPronajmeneInput.value = '';
                    modelDropdown.classList.remove('show');
                }
            }

            // Listen for brand selection in "Poškozené vozidlo"
            znackaPoskozene.addEventListener('input', handleBrandChangePoskozene);

            // Listen for brand selection in "Pronajímané vozidlo"
            znackaPronajmene.addEventListener('input', handleBrandChangePronajmene);

            // Also check when autocomplete item is clicked
            const znackaPoskozeneDropdown = document.getElementById('znackaPoskozeneDropdown');
            const znackaPronajmeneDropdown = document.getElementById('znackaPronajmeneDropdown');

            // Add event delegation for brand dropdown clicks
            znackaPoskozeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(() => {
                        handleBrandChangePoskozene();
                    }, 50);
                }
            });

            znackaPronajmeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(() => {
                        handleBrandChangePronajmene();
                    }, 50);
                }
            });
        }

        // Mapping table for Škoda models to VW equivalents and categories
        const skodaVWMapping = [
            { "skoda": "Škoda Citigo", "vw": "VW Up!", "kategorie": "Mini" },
            { "skoda": "Škoda Fabia", "vw": "VW Polo", "kategorie": "Malá" },
            { "skoda": "Škoda Scala", "vw": "VW Golf", "kategorie": "Nižší střední" },
            { "skoda": "Škoda Octavia", "vw": "VW Golf", "kategorie": "Nižší střední" },
            { "skoda": "Škoda Superb", "vw": "VW Passat", "kategorie": "Střední" },
            { "skoda": "Škoda Karoq", "vw": "VW T-Roc", "kategorie": "SUV malé" },
            { "skoda": "Škoda Kodiaq", "vw": "VW Tiguan", "kategorie": "SUV velké" },
            { "skoda": "Škoda Roomster", "vw": "VW Caddy", "kategorie": "MPV malá" },
            { "skoda": "Škoda Yeti", "vw": "VW T-Roc", "kategorie": "SUV malé" }
        ];

        // Find category by brand and model
        function findCategory(brand, model) {
            if (!brand || !model) return null;
            
            const brandLower = brand.toLowerCase();
            const modelLower = model.toLowerCase();
            
            // Special handling for Škoda - in "vozy Škoda" category, znacka_typ contains only models
            if (brandLower === 'škoda' || brandLower === 'skoda') {
                const item = cenÝkData.find(data => {
                    if (data.kategorie && data.kategorie.toLowerCase().includes('škoda')) {
                        const znackaTyp = data.znacka_typ.toLowerCase();
                        
                        // Check if znacka_typ contains the model
                        // Handle cases like "Octavia I + II", "Octavia III + IV", "Fabia + Roomster"
                        
                        // First check if it's a version pattern like "Octavia I + II" or "Octavia III + IV"
                        const fullVersionPattern = /^([a-z\s]+)\s+([ivx]+)\s*\+\s*([ivx]+)$/i;
                        const fullVersionMatch = znackaTyp.match(fullVersionPattern);
                        
                        if (fullVersionMatch) {
                            // It's a version pattern - check if model matches base name or any version
                            const baseModel = fullVersionMatch[1].trim();
                            const version1 = fullVersionMatch[2].trim();
                            const version2 = fullVersionMatch[3].trim();
                            
                            // Check if model matches base name (e.g., "Octavia" matches "Octavia I + II")
                            if (modelLower === baseModel) {
                                return true;
                            }
                            
                            // Check if model matches base + version1 (e.g., "Octavia I" matches "Octavia I + II")
                            if (modelLower === (baseModel + ' ' + version1).trim()) {
                                return true;
                            }
                            
                            // Check if model matches base + version2 (e.g., "Octavia II" matches "Octavia I + II")
                            if (modelLower === (baseModel + ' ' + version2).trim()) {
                                return true;
                            }
                            
                            // Also check if model contains base name and version (e.g., "Octavia IV" contains "Octavia" and "IV")
                            if (modelLower.includes(baseModel)) {
                                const modelVersion = modelLower.replace(baseModel, '').trim();
                                if (modelVersion === version1 || modelVersion === version2) {
                                    return true;
                                }
                            }
                        } else {
                            // Regular models separated by + (e.g., "Fabia + Roomster", "Scala + Kamiq + Yeti")
                            const models = znackaTyp.split('+').map(m => m.trim().toLowerCase());
                            
                            // Check if any model matches
                            if (models.some(m => {
                                // Direct match
                                if (m === modelLower) return true;
                                // Check if model contains the model name (e.g., "Octavia II" contains "Octavia")
                                if (modelLower.includes(m) || m.includes(modelLower)) return true;
                                // Check if it's a version pattern in the model
                                const singleVersionPattern = /^([a-z\s]+)\s+([ivx]+)$/i;
                                const singleMatch = m.match(singleVersionPattern);
                                if (singleMatch) {
                                    const baseModel = singleMatch[1].trim();
                                    const version = singleMatch[2].trim();
                                    // Check if input model matches base + version
                                    if (modelLower === (baseModel + ' ' + version).trim()) return true;
                                    // Check if input model contains base and version
                                    if (modelLower.includes(baseModel) && modelLower.includes(version)) return true;
                                }
                                return false;
                            })) {
                                return true;
                            }
                        }
                    }
                    return false;
                });
                
                // For Škoda, always return category from ceník (not mapping)
                // Mapping is only used for comparison when rental vehicle is different brand
                if (item && item.kategorie) {
                    return item.kategorie;
                }
                
                return null;
            }
            
            // For other brands, najdi NEJLÉPE odpovídající řádek – preferuj konkrétnější model
            // (např. "C3 Aircross") před obecnějším (např. "C3"), aby
            // Citroën C3 Aircross spadl do "SUV malé", ne do obecné "Malá C3".
            let bestItem = null;
            let bestScore = 0;

            cenÝkData.forEach(data => {
                const znackaTyp = data.znacka_typ.toLowerCase();
                const parts = znackaTyp.split(',');

                parts.forEach(rawPart => {
                    const partTrimmed = rawPart.trim();
                    if (!partTrimmed) return;

                    // U značek typu "Mercedes-Benz" vs "Mercedes Benz" použij normalizované porovnání
                    const partLower = partTrimmed.toLowerCase();
                    const normalizedBrand = brandLower.replace(/-/g, ' ').replace(/\s+/g, ' ').trim();
                    const normalizedPart = partLower.replace(/-/g, ' ').replace(/\s+/g, ' ').trim();

                    if (!(partLower.includes(brandLower) || normalizedPart.includes(normalizedBrand))) return;

                    const models = partTrimmed.split('+').map(m => m.trim().toLowerCase());
                    let lastBase = '';

                    models.forEach(m => {
                        if (!m) return;

                        // Odeber značku z modelu, pokud je přítomna
                        let modelOnly = m.startsWith(brandLower)
                            ? m.slice(brandLower.length).trim()
                            : m.trim();
                        if (!modelOnly) return;

                        const isPureSeriesNumber = /^[0-9]+$/.test(modelOnly);
                        let score = 0;

                        // Pokud máme pattern typu "IONIQ 5 + 6",
                        // první část "ioniq 5" -> lastBase = "ioniq",
                        // druhá část "6" -> chovej se jako "ioniq 6".
                        if (isPureSeriesNumber && lastBase) {
                            const combined = `${lastBase} ${modelOnly}`.trim(); // např. "ioniq 6"
                            if (modelLower === combined) {
                                score = 6;
                            } else if (combined.includes(modelLower) || modelLower.includes(combined)) {
                                score = 4;
                            }
                        } else if (isPureSeriesNumber) {
                            // Pro čistě číselné řady ("1", "2" atd.) bez základu dovol jen přesnou shodu,
                            // aby "BMW 2 Tourer" neskončilo na generickém "BMW 1 + 2".
                            if (modelLower === modelOnly) {
                                score = 5;
                            }
                        } else {
                            // 1) Nejvyšší priorita – přesná shoda modelu bez značky
                            if (modelLower === modelOnly) {
                                score = 6;
                            }
                            // 2) Shoda celého m (včetně značky) s brand + model
                            else if (m === `${brandLower} ${modelLower}`) {
                                score = 5;
                            }
                            // 3) m obsahuje celý zadaný model
                            else if (m.includes(modelLower)) {
                                score = 4;
                            }
                            // 4) zadaný model obsahuje modelOnly (např. "c3 aircross" obsahuje "c3")
                            else if (modelLower.includes(modelOnly)) {
                                score = 2;
                            }

                            // Aktualizuj lastBase pro příští čistě číselné části – "<base> <číslo>"
                            const baseCandidate = modelOnly.replace(/\s*\d+$/, '').trim();
                            if (baseCandidate && baseCandidate !== modelOnly) {
                                lastBase = baseCandidate;
                            } else {
                                lastBase = '';
                            }
                        }

                        if (score > bestScore) {
                            bestScore = score;
                            bestItem = data;
                        }
                    });

                    // Fallback – pokud nic neodpovídalo ve výčtu modelů, zkus část za značkou
                    const brandIndex = partTrimmed.indexOf(brandLower);
                    if (brandIndex !== -1) {
                        const afterBrand = partTrimmed
                            .substring(brandIndex + brandLower.length)
                            .trim();
                        if (afterBrand && afterBrand.toLowerCase().includes(modelLower)) {
                            const score = 1;
                            if (score > bestScore) {
                                bestScore = score;
                                bestItem = data;
                            }
                        }
                    }
                });
            });

            return bestItem ? bestItem.kategorie : null;
        }

        // Get category hierarchy for downgrading (ordered from lowest to highest)
        const categoryHierarchy = [
            'vozy Škoda',
            'Mini',
            'Malá',
            'Malá ',
            'Malá premium',
            'Nižší střední',
            'Nižší střední premium',
            'Střední',
            'Střední premium',
            'Vyšší střední',
            'Vyšší střední premium',
            'Luxusní',
            'MPV malá',
            'MPV střední',
            'MPV velká',
            'SUV malé',
            'SUV malé ',
            'SUV malé premium',
            'SUV malé premium ',
            'SUV střední',
            'SUV střední ',
            'SUV střední premium',
            'SUV velké',
            'SUV velké ',
            'SUV velké premium',
            'Luxusní SUV',
            'Užitková malá',
            'Užitková střední',
            'Užitková velká',
            'Pick - up',
            'Mikrobus'
        ];

        // Get lower category (one class down within the same vehicle type)
        function getLowerCategory(category) {
            if (!category) return null;
            
            const trimmedCategory = category.trim();
            
            // Category groups ordered from highest to lowest
            const osobniVozy = [
                'Luxusní',
                'Vyšší střední premium',
                'Vyšší střední',
                'Střední premium',
                'Střední',
                'Nižší střední premium',
                'Nižší střední',
                'Malá premium',
                'Malá',
                'Malá ',
                'Mini',
                'vozy Škoda'
            ];
            
            const suv = [
                'Luxusní SUV',
                'SUV velké premium',
                'SUV velké',
                'SUV velké ',
                'SUV střední premium',
                'SUV střední',
                'SUV střední ',
                'SUV malé premium',
                'SUV malé premium ',
                'SUV malé',
                'SUV malé '
            ];
            
            const mpv = [
                'MPV velká',
                'MPV střední',
                'MPV malá'
            ];
            
            const uzitkova = [
                'Užitková velká',
                'Užitková střední',
                'Užitková malá'
            ];
            
            // Special categories that cannot be downgraded
            const special = ['Pick - up', 'Mikrobus'];
            
            // Helper function to find lower category in a group
            function findLowerInGroup(category, group) {
                // Try exact match
                let index = group.indexOf(category);
                if (index === -1) {
                    // Try with trimmed
                    const trimmed = category.trim();
                    for (let i = 0; i < group.length; i++) {
                        if (group[i].trim() === trimmed) {
                            index = i;
                            break;
                        }
                    }
                }
                
                if (index === -1) return null;
                if (index === group.length - 1) return null; // Already at lowest
                return group[index + 1]; // Return next (lower) category
            }
            
            // Check if category is in special group (cannot be downgraded)
            if (special.includes(category) || special.some(s => s.trim() === trimmedCategory)) {
                return null;
            }
            
            // Try to find in osobní vozy group
            let lower = findLowerInGroup(category, osobniVozy);
            if (lower !== null) return lower;
            
            // Try with trimmed for osobní vozy
            for (let i = 0; i < osobniVozy.length; i++) {
                if (osobniVozy[i].trim() === trimmedCategory) {
                    if (i < osobniVozy.length - 1) {
                        return osobniVozy[i + 1];
                    }
                    return null;
                }
            }
            
            // Try to find in SUV group
            lower = findLowerInGroup(category, suv);
            if (lower !== null) return lower;
            
            // Try with trimmed for SUV
            for (let i = 0; i < suv.length; i++) {
                if (suv[i].trim() === trimmedCategory) {
                    if (i < suv.length - 1) {
                        return suv[i + 1];
                    }
                    return null;
                }
            }
            
            // Try to find in MPV group
            lower = findLowerInGroup(category, mpv);
            if (lower !== null) return lower;
            
            // Try with trimmed for MPV
            for (let i = 0; i < mpv.length; i++) {
                if (mpv[i].trim() === trimmedCategory) {
                    if (i < mpv.length - 1) {
                        return mpv[i + 1];
                    }
                    return null;
                }
            }
            
            // Try to find in Užitková group
            lower = findLowerInGroup(category, uzitkova);
            if (lower !== null) return lower;
            
            // Try with trimmed for Užitková
            for (let i = 0; i < uzitkova.length; i++) {
                if (uzitkova[i].trim() === trimmedCategory) {
                    if (i < uzitkova.length - 1) {
                        return uzitkova[i + 1];
                    }
                    return null;
                }
            }
            
            // Category not found in any group, return null
            return null;
        }

        // Compare categories - returns 1 if category1 is higher, -1 if lower, 0 if equal
        function compareCategories(category1, category2) {
            if (!category1 || !category2) return 0;
            
            const index1 = categoryHierarchy.indexOf(category1);
            const index2 = categoryHierarchy.indexOf(category2);
            
            // Try to find with trimmed comparison
            let foundIndex1 = index1;
            let foundIndex2 = index2;
            
            if (foundIndex1 === -1) {
                const trimmed1 = category1.trim();
                for (let i = 0; i < categoryHierarchy.length; i++) {
                    if (categoryHierarchy[i].trim() === trimmed1) {
                        foundIndex1 = i;
                        break;
                    }
                }
            }
            
            if (foundIndex2 === -1) {
                const trimmed2 = category2.trim();
                for (let i = 0; i < categoryHierarchy.length; i++) {
                    if (categoryHierarchy[i].trim() === trimmed2) {
                        foundIndex2 = i;
                        break;
                    }
                }
            }
            
            if (foundIndex1 === -1 || foundIndex2 === -1) return 0;
            
            if (foundIndex1 > foundIndex2) return 1; // category1 is higher
            if (foundIndex1 < foundIndex2) return -1; // category1 is lower
            return 0; // equal
        }

        // Find price by category (optionally with brand and model for "vozy Škoda")
        function findPriceByCategory(category, brand, model) {
            if (!category) return null;
            
            // Special handling for "vozy Škoda" - need to find specific model
            if (category === 'vozy Škoda' && brand && model) {
                const brandLower = brand.toLowerCase();
                const modelLower = model.toLowerCase();
                
                if (brandLower === 'škoda' || brandLower === 'skoda') {
                    const item = cenÝkData.find(data => {
                        if (data.kategorie !== 'vozy Škoda') return false;
                        const znackaTyp = data.znacka_typ.toLowerCase();
                        
                        // Check version patterns like "Octavia I + II"
                        const fullVersionPattern = /^([a-z\s]+)\s+([ivx]+)\s*\+\s*([ivx]+)$/i;
                        const fullVersionMatch = znackaTyp.match(fullVersionPattern);
                        
                        if (fullVersionMatch) {
                            const baseModel = fullVersionMatch[1].trim();
                            const version1 = fullVersionMatch[2].trim();
                            const version2 = fullVersionMatch[3].trim();
                            
                            if (modelLower === baseModel ||
                                modelLower === (baseModel + ' ' + version1).trim() ||
                                modelLower === (baseModel + ' ' + version2).trim()) {
                                return true;
                            }
                            
                            if (modelLower.includes(baseModel)) {
                                const modelVersion = modelLower.replace(baseModel, '').trim();
                                if (modelVersion === version1 || modelVersion === version2) {
                                    return true;
                                }
                            }
                        } else {
                            // Regular models separated by +
                            const models = znackaTyp.split('+').map(m => m.trim().toLowerCase());
                            if (models.some(m => {
                                if (m === modelLower) return true;
                                if (modelLower.includes(m) || m.includes(modelLower)) return true;
                                const singleVersionPattern = /^([a-z\s]+)\s+([ivx]+)$/i;
                                const singleMatch = m.match(singleVersionPattern);
                                if (singleMatch) {
                                    const baseModel = singleMatch[1].trim();
                                    const version = singleMatch[2].trim();
                                    if (modelLower === (baseModel + ' ' + version).trim()) return true;
                                    if (modelLower.includes(baseModel) && modelLower.includes(version)) return true;
                                }
                                return false;
                            })) {
                                return true;
                            }
                        }
                        return false;
                    });
                    
                    if (item) {
                        return {
                            cena_1_10: item.cena_1_10_dni,
                            cena_11_30: item.cena_11_30_dni,
                            kategorie: item.kategorie
                        };
                    }
                }
            }
            
            // Find first item with matching category
            const item = cenÝkData.find(data => data.kategorie === category);
            return item ? {
                cena_1_10: item.cena_1_10_dni,
                cena_11_30: item.cena_11_30_dni,
                kategorie: item.kategorie
            } : null;
        }

        const calculationMessageElement = document.getElementById('calculationMessage');
        let calculationMessageTimeout;

        function showCalculationMessage() {
            if (!calculationMessageElement) return;
            calculationMessageElement.textContent = '✅ Hotovo! Sazba přepočtena.';
            calculationMessageElement.setAttribute('aria-hidden', 'false');
            calculationMessageElement.classList.remove('visible');
            // Force reflow to restart animation if needed
            void calculationMessageElement.offsetWidth;
            calculationMessageElement.classList.add('visible');
            clearTimeout(calculationMessageTimeout);
            calculationMessageTimeout = setTimeout(() => {
                calculationMessageElement.classList.remove('visible');
                calculationMessageElement.setAttribute('aria-hidden', 'true');
            }, 4000);
        }

        function hideCalculationMessage() {
            if (!calculationMessageElement) return;
            calculationMessageElement.classList.remove('visible');
            calculationMessageElement.setAttribute('aria-hidden', 'true');
            clearTimeout(calculationMessageTimeout);
        }

        // Calculate
        function calculate() {
            // Get values from form
            const rokProvozu = document.getElementById('rokProvozu').value;
            const znackaPoskozene = document.getElementById('znackaPoskozene').value;
            const modelPoskozene = document.getElementById('modelPoskozene').value;
            const znackaPronajmene = document.getElementById('znackaPronajmene').value;
            const modelPronajmene = document.getElementById('modelPronajmene').value;

            // Validate required fields
            if (!rokProvozu) {
                alert('Prosím vyberte rok uvedení do provozu poškozeného vozidla');
                return;
            }

            if (!modelPronajmene) {
                alert('Prosím vyberte model pronajímaného vozidla');
                return;
            }

            if (!znackaPronajmene) {
                alert('Prosím vyberte značku pronajímaného vozidla');
                return;
            }

            // Find category of rental vehicle
            let rentalCategory = findCategory(znackaPronajmene, modelPronajmene);
            
            if (!rentalCategory) {
                alert('Kategorie pro vybrané pronajímané vozidlo nebyla nalezena. Zkuste vybrat jiný model nebo značku.');
                return;
            }

            // Find category of damaged vehicle (if brand and model are provided)
            let damagedCategory = null;
            let damagedCategoryForComparison = null; // Category for comparison (may use mapping)
            
            if (znackaPoskozene && modelPoskozene) {
                const damagedBrandLower = znackaPoskozene.toLowerCase();
                
                // Check if damaged vehicle is Škoda
                if (damagedBrandLower === 'škoda' || damagedBrandLower === 'skoda') {
                    // For Škoda, get category from ceník (for pricing)
                    damagedCategory = findCategory(znackaPoskozene, modelPoskozene);
                    
                    // But if rental vehicle is different brand, use mapping for comparison
                    const rentalBrandLower = znackaPronajmene.toLowerCase();
                    if (rentalBrandLower !== 'škoda' && rentalBrandLower !== 'skoda') {
                        // Use mapping to get equivalent category for comparison
                        const fullModelName = 'Škoda ' + modelPoskozene;
                        const modelLower = modelPoskozene.toLowerCase();
                        
                        for (const mapping of skodaVWMapping) {
                            const skodaModelLower = mapping.skoda.toLowerCase();
                            
                            // Check exact match
                            if (skodaModelLower === fullModelName.toLowerCase()) {
                                damagedCategoryForComparison = mapping.kategorie;
                                break;
                            }
                            
                            // Check if model name starts with mapped model
                            if (fullModelName.toLowerCase().startsWith(skodaModelLower)) {
                                damagedCategoryForComparison = mapping.kategorie;
                                break;
                            }
                            
                            // Check if mapped model contains the base model
                            const baseModel = modelLower.split(' ')[0];
                            const mappedBaseModel = skodaModelLower.replace('škoda ', '').split(' ')[0];
                            
                            if (baseModel === mappedBaseModel) {
                                damagedCategoryForComparison = mapping.kategorie;
                                break;
                            }
                        }
                    } else {
                        // Both are Škoda, use ceník category for comparison too
                        damagedCategoryForComparison = damagedCategory;
                    }
                } else {
                    // Not Škoda, use normal category finding
                    damagedCategory = findCategory(znackaPoskozene, modelPoskozene);
                    damagedCategoryForComparison = damagedCategory;
                }
            }

            // Determine base category - client has right to same or lower class
            // If rental vehicle is higher class than damaged vehicle, use damaged vehicle category as maximum
            let baseCategory = rentalCategory;
            let useDamagedVehiclePrice = false; // Flag to track if we should use damaged vehicle price
            if (damagedCategoryForComparison) {
                // Special handling: if both are "vozy Škoda", compare by price instead of category
                if (rentalCategory === 'vozy Škoda' && damagedCategoryForComparison === 'vozy Škoda') {
                    // Find prices for both vehicles
                    const rentalPrice = findPriceByCategory(rentalCategory, znackaPronajmene, modelPronajmene);
                    const damagedPrice = findPriceByCategory(damagedCategoryForComparison, znackaPoskozene, modelPoskozene);
                    
                    if (rentalPrice && damagedPrice) {
                        // Compare by price (1-10 days)
                        if (rentalPrice.cena_1_10 > damagedPrice.cena_1_10) {
                            // Rental vehicle is higher class - use damaged vehicle category and price
                            baseCategory = damagedCategory || damagedCategoryForComparison;
                            useDamagedVehiclePrice = true;
                        } else {
                            // Rental vehicle is same or lower class - use rental category
                            baseCategory = rentalCategory;
                            useDamagedVehiclePrice = false;
                        }
                    }
                } else {
                    // Normal category comparison
                    const comparison = compareCategories(rentalCategory, damagedCategoryForComparison);
                    if (comparison > 0) {
                        // Rental vehicle is higher class than damaged vehicle
                        // Client has right only to damaged vehicle category
                        // But use the actual category from ceník for pricing (not the mapped one)
                        baseCategory = damagedCategory || damagedCategoryForComparison;
                        useDamagedVehiclePrice = true;
                    } else {
                        // Rental vehicle is same or lower class - use rental category
                        baseCategory = rentalCategory;
                        useDamagedVehiclePrice = false;
                    }
                }
            }

            // Check if damaged vehicle is older than 8 years
            let finalCategory = baseCategory;
            let finalPriceEntry = null; // For special Škoda downgrade within same category
            const currentYear = new Date().getFullYear();
            const yearOfProduction = parseInt(rokProvozu);
            let apply20PercentDiscount = false; // Flag for 20% discount for vehicles older than 8 years
            
            if (isNaN(yearOfProduction)) {
                alert('Neplatný rok uvedení do provozu. Zkuste vybrat rok znovu.');
                return;
            }
            
            // Check if damaged vehicle is older than 8 years
            const isDamagedVehicleOlderThan8Years = (currentYear - yearOfProduction) > 8;
            
            if (isDamagedVehicleOlderThan8Years) {
                // 20% discount applies ONLY if rental vehicle is the SAME category as damaged vehicle
                // If rental vehicle is LOWER category, NO discount is applied
                let isSameCategory = false;
                
                if (damagedCategoryForComparison) {
                    // Special handling: if both are "vozy Škoda", compare by price instead of category
                    if (rentalCategory === 'vozy Škoda' && damagedCategoryForComparison === 'vozy Škoda') {
                        // Find prices for both vehicles
                        const rentalPrice = findPriceByCategory(rentalCategory, znackaPronajmene, modelPronajmene);
                        const damagedPrice = findPriceByCategory(damagedCategoryForComparison, znackaPoskozene, modelPoskozene);
                        
                        if (rentalPrice && damagedPrice) {
                            // Compare by price (1-10 days) - same category if prices are equal
                            isSameCategory = (rentalPrice.cena_1_10 === damagedPrice.cena_1_10);
                        }
                    } else {
                        // Normal category comparison - same category if comparison returns 0
                        const comparison = compareCategories(rentalCategory, damagedCategoryForComparison);
                        isSameCategory = (comparison === 0);
                    }
                }
                
                // Apply 20% discount only if same category
                if (isSameCategory) {
                    apply20PercentDiscount = true;
                }
                // Keep original category, no downgrade needed
                finalCategory = baseCategory;
            }

            // Find price for final category
            // If useDamagedVehiclePrice is true, use damaged vehicle price (for all categories)
            // If finalCategory is "vozy Škoda" and we have brand/model, use specific price
            let price = finalPriceEntry;
            if (!price) {
                if (useDamagedVehiclePrice && znackaPoskozene && modelPoskozene) {
                    // Rental vehicle is higher class - use damaged vehicle price
                    // Try to find specific price for damaged vehicle in its category
                    if (finalCategory === 'vozy Škoda') {
                        price = findPriceByCategory(finalCategory, znackaPoskozene, modelPoskozene);
                    } else {
                        // For non-Skoda categories, use category price (which should match damaged vehicle category)
                        price = findPriceByCategory(finalCategory);
                    }
                } else if (finalCategory === 'vozy Škoda' && znackaPronajmene && modelPronajmene) {
                    // Use rental vehicle price for Škoda
                    price = findPriceByCategory(finalCategory, znackaPronajmene, modelPronajmene);
                } else {
                    // Use generic category price
                    price = findPriceByCategory(finalCategory);
                }
            }
            
            if (price) {
                let finalPrice1_10 = price.cena_1_10 || price.cena_1_10_dni;
                let finalPrice11_30 = price.cena_11_30 || price.cena_11_30_dni;
                
                // Apply 20% discount if vehicle is older than 8 years (before final price comparison)
                if (apply20PercentDiscount) {
                    finalPrice1_10 = Math.round(finalPrice1_10 * 0.8);
                    finalPrice11_30 = Math.round(finalPrice11_30 * 0.8);
                }
                
                // Calculate final damaged vehicle price (with 20% discount if older than 8 years)
                // This is the maximum price that rental vehicle can have
                let finalDamagedPrice1_10 = null;
                let finalDamagedPrice11_30 = null;
                if (damagedCategory && znackaPoskozene && modelPoskozene) {
                    // Get damaged vehicle price
                    let damagedPrice = null;
                    if (damagedCategory === 'vozy Škoda') {
                        damagedPrice = findPriceByCategory(damagedCategory, znackaPoskozene, modelPoskozene);
                    } else {
                        damagedPrice = findPriceByCategory(damagedCategory);
                    }
                    
                    if (damagedPrice) {
                        let damagedPrice1_10 = damagedPrice.cena_1_10 || damagedPrice.cena_1_10_dni;
                        let damagedPrice11_30 = damagedPrice.cena_11_30 || damagedPrice.cena_11_30_dni;
                        
                        // Apply 20% discount to damaged vehicle if it's older than 8 years
                        if (isDamagedVehicleOlderThan8Years) {
                            damagedPrice1_10 = Math.round(damagedPrice1_10 * 0.8);
                            damagedPrice11_30 = Math.round(damagedPrice11_30 * 0.8);
                        }
                        
                        finalDamagedPrice1_10 = damagedPrice1_10;
                        finalDamagedPrice11_30 = damagedPrice11_30;
                    }
                }
                
                // Final check: rental price (after discount) must not exceed damaged vehicle price (after discount)
                // This ensures rental rate is never higher than damaged vehicle rate
                // This check applies ALWAYS, regardless of useDamagedVehiclePrice flag
                let shouldUseDamagedPriceAsMax = false;
                if (finalDamagedPrice1_10 !== null && finalDamagedPrice11_30 !== null) {
                    // If rental price (after discount) is higher than damaged price (after discount), use damaged price as maximum
                    if (finalPrice1_10 > finalDamagedPrice1_10 || finalPrice11_30 > finalDamagedPrice11_30) {
                        finalPrice1_10 = finalDamagedPrice1_10;
                        finalPrice11_30 = finalDamagedPrice11_30;
                        shouldUseDamagedPriceAsMax = true;
                    }
                } else if (damagedCategory && znackaPoskozene && modelPoskozene) {
                    // Fallback: if we couldn't calculate final damaged price in first attempt, try again
                    let damagedPrice = null;
                    if (damagedCategory === 'vozy Škoda') {
                        damagedPrice = findPriceByCategory(damagedCategory, znackaPoskozene, modelPoskozene);
                    } else {
                        damagedPrice = findPriceByCategory(damagedCategory);
                    }
                    
                    if (damagedPrice) {
                        let damagedPrice1_10 = damagedPrice.cena_1_10 || damagedPrice.cena_1_10_dni;
                        let damagedPrice11_30 = damagedPrice.cena_11_30 || damagedPrice.cena_11_30_dni;
                        
                        // Apply 20% discount to damaged vehicle if it's older than 8 years
                        if (isDamagedVehicleOlderThan8Years) {
                            damagedPrice1_10 = Math.round(damagedPrice1_10 * 0.8);
                            damagedPrice11_30 = Math.round(damagedPrice11_30 * 0.8);
                        }
                        
                        // If rental price (after discount) is higher than damaged price (after discount), use damaged price as maximum
                        if (finalPrice1_10 > damagedPrice1_10 || finalPrice11_30 > damagedPrice11_30) {
                            finalPrice1_10 = damagedPrice1_10;
                            finalPrice11_30 = damagedPrice11_30;
                            shouldUseDamagedPriceAsMax = true;
                        }
                    }
                }
                
                const priceText1 = finalPrice1_10.toLocaleString('cs-CZ') + ' Kč bez DPH';
                const priceText2 = finalPrice11_30.toLocaleString('cs-CZ') + ' Kč bez DPH';
                
                // Collect notes if category was adjusted
                const notes = [];
                
                // Check if rental vehicle was higher class than damaged vehicle
                // This applies both for normal category comparison and for Škoda price comparison
                // Also applies when rental price is higher than damaged price (even if categories cannot be compared)
                if (useDamagedVehiclePrice || shouldUseDamagedPriceAsMax || (damagedCategory && compareCategories(rentalCategory, damagedCategory) > 0)) {
                    notes.push('Nárok max. podle kategorie poškozeného vozidla');
                }
                
                // Set price values
                document.getElementById('cenaDo14').textContent = priceText1;
                document.getElementById('cenaNad14').textContent = priceText2;
                
                // Set notes on separate lines (only for category adjustment, not for discount)
                const noteText = notes.length > 0 ? notes.join('. ') : '';
                document.getElementById('noteDo14').textContent = noteText;
                document.getElementById('noteNad14').textContent = noteText;

                // Update print prices block – zde aktualizujeme jen
                // "Výsledná sazba pronajímaného vozidla", nikoli blok poškozeného vozidla.
                const printPriceNote = document.getElementById('printPriceNote');
                const printDiscountNote = document.getElementById('printDiscountNote');
                const printRentalPrice1_10 = document.getElementById('printRentalPrice1_10');
                const printRentalPrice11_30 = document.getElementById('printRentalPrice11_30');

                if (printRentalPrice1_10) printRentalPrice1_10.textContent = priceText1;
                if (printRentalPrice11_30) printRentalPrice11_30.textContent = priceText2;
                if (printPriceNote) printPriceNote.textContent = noteText;

                // Show/hide discount info separately for screen and print
                const discountInfo = document.getElementById('discountInfo');
                if (discountInfo) {
                    if (apply20PercentDiscount) {
                        discountInfo.style.display = 'block';
                    } else {
                        discountInfo.style.display = 'none';
                    }
                }
                if (printDiscountNote) {
                    if (apply20PercentDiscount) {
                        printDiscountNote.style.display = 'block';
                    } else {
                        printDiscountNote.style.display = 'none';
                    }
                }
                
                // Show intro text in results section
                const rentalVehicleIntroText = document.getElementById('rentalVehicleIntroText');
                if (rentalVehicleIntroText) {
                    rentalVehicleIntroText.style.display = 'block';
                }
                
                const resultsSection = document.getElementById('resultsSection');
                resultsSection.style.display = 'block';
                
                // Trigger animation by adding visible class after a small delay
                setTimeout(() => {
                    resultsSection.classList.add('visible');
                }, 10);
                showCalculationMessage();
                
                // Add class for print visibility
                resultsSection.classList.add('show-in-print');
                const rentalSection = document.querySelector('.form-section:nth-of-type(3)');
                if (rentalSection) {
                    rentalSection.classList.add('show-in-print');
                }
                
                // Update print date and vehicle info
                const now = new Date();
                const dateStr = now.toLocaleDateString('cs-CZ', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const printDateElement = document.getElementById('printDate');
                if (printDateElement) {
                    printDateElement.textContent = dateStr;
                }
                
                // Update print vehicle info
                const printDamagedYear = document.getElementById('printDamagedYear');
                const printDamagedBrand = document.getElementById('printDamagedBrand');
                const printDamagedModel = document.getElementById('printDamagedModel');
                const printDamagedCategory = document.getElementById('printDamagedCategory');
                const printDamagedCategoryNote = document.getElementById('printDamagedCategoryNote');
                const printRentalDate = document.getElementById('printRentalDate');
                const printRentalBrand = document.getElementById('printRentalBrand');
                const printRentalModel = document.getElementById('printRentalModel');
                
                if (printDamagedYear) printDamagedYear.textContent = document.getElementById('rokProvozu').value || '-';
                if (printDamagedBrand) printDamagedBrand.textContent = document.getElementById('znackaPoskozene').value || '-';
                if (printDamagedModel) printDamagedModel.textContent = document.getElementById('modelPoskozene').value || '-';
                
                // Get damaged category from intermediate step
                const damagedCategoryName = document.getElementById('damagedCategoryName');
                if (printDamagedCategory && damagedCategoryName) {
                    printDamagedCategory.textContent = damagedCategoryName.textContent || '-';
                }
                
                // Get category note if exists
                const damagedCategoryNote = document.getElementById('damagedCategoryNote');
                if (printDamagedCategoryNote && damagedCategoryNote && damagedCategoryNote.textContent) {
                    printDamagedCategoryNote.textContent = damagedCategoryNote.textContent;
                    printDamagedCategoryNote.style.display = 'block';
                } else if (printDamagedCategoryNote) {
                    printDamagedCategoryNote.style.display = 'none';
                }
                
                // Rental year removed - no longer needed
                if (printRentalDate) {
                    printRentalDate.textContent = '-';
                }
                
                if (printRentalBrand) printRentalBrand.textContent = document.getElementById('znackaPronajmene').value || '-';
                if (printRentalModel) printRentalModel.textContent = document.getElementById('modelPronajmene').value || '-';
            } else {
                alert('Cena pro vybranou kategorii nebyla nalezena.');
            }
        }

        // Format brand and model text - make brands bold
        function formatBrandModelText(text, category) {
            if (!text) return '';
            
            // Helper function to normalize brand name
            function normalizeBrand(brandName) {
                return brandName
                    .replace(/-/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
            }
            
            // Helper function to find matching brand at the start of text
            function findMatchingBrand(part) {
                const partLower = part.toLowerCase();
                
                // Try exact match first
                for (const brand of vehicleBrands) {
                    const brandLower = brand.toLowerCase();
                    const brandNormalized = normalizeBrand(brand).toLowerCase();
                    const partNormalized = normalizeBrand(part).toLowerCase();
                    
                    // Check if part starts with brand name (with space after)
                    if (partLower.startsWith(brandLower + ' ') || 
                        partNormalized.startsWith(brandNormalized + ' ') ||
                        partLower === brandLower) {
                        return brand;
                    }
                }
                
                // If no exact match, try to extract brand from beginning of part
                for (const brand of vehicleBrands) {
                    const brandLower = brand.toLowerCase();
                    const brandWords = brandLower.split(/\s+/);
                    const partWords = partLower.split(/\s+/);
                    
                    // Check if first word(s) match brand
                    let matches = true;
                    for (let i = 0; i < brandWords.length && i < partWords.length; i++) {
                        if (partWords[i] !== brandWords[i]) {
                            matches = false;
                            break;
                        }
                    }
                    
                    if (matches && partWords.length > brandWords.length) {
                        return brand;
                    }
                }
                
                return null;
            }
            
            // Special handling for "vozy Škoda" - replace " + " with ", " but don't format brands
            if (category && category.toLowerCase().includes('škoda')) {
                // Replace " + " with ", " for Škoda models
                return text.replace(/\s*\+\s*/g, ', ');
            }
            
            // Also check if text looks like Škoda models (no brand names, just models like "Citigo", "Fabia + Roomster")
            const isSkodaCategory = !text.includes(',') || 
                (text.split(',').length === 1 && !findMatchingBrand(text));
            
            if (isSkodaCategory) {
                // For Škoda category, replace " + " with ", " but don't format brands
                return text.replace(/\s*\+\s*/g, ', ');
            }
            
            // Replace " + " with ", " and " +" or "+ " with ", " (for cases like "5+6" or "A4 +A5")
            // This handles models within the same brand
            text = text.replace(/\s*\+\s*/g, ', ');
            
            // Split by comma to get individual entries
            const parts = text.split(',');
            const formattedParts = parts.map(part => {
                part = part.trim();
                if (!part) return '';
                
                const matchedBrand = findMatchingBrand(part);
                if (matchedBrand) {
                    // Find where brand name ends in the original text
                    const brandLower = matchedBrand.toLowerCase();
                    const partLower = part.toLowerCase();
                    const brandNormalized = normalizeBrand(matchedBrand).toLowerCase();
                    const partNormalized = normalizeBrand(part).toLowerCase();
                    
                    let brandEndIndex = -1;
                    
                    // Try to find exact brand match position
                    if (partLower.startsWith(brandLower + ' ')) {
                        brandEndIndex = matchedBrand.length;
                    } else if (partLower.startsWith(brandLower)) {
                        // Brand found but might be followed by model without space
                        brandEndIndex = matchedBrand.length;
                    } else if (partNormalized.startsWith(brandNormalized + ' ')) {
                        // Find position in original text by matching normalized versions
                        // Try different lengths to find where normalized brand ends
                        for (let i = 1; i <= part.length; i++) {
                            const testPart = normalizeBrand(part.substring(0, i)).toLowerCase();
                            if (testPart === brandNormalized) {
                                brandEndIndex = i;
                                break;
                            } else if (testPart.length > brandNormalized.length) {
                                break;
                            }
                        }
                        if (brandEndIndex === -1) {
                            brandEndIndex = matchedBrand.length; // Fallback
                        }
                    } else if (partNormalized.startsWith(brandNormalized)) {
                        // Similar logic for case without space
                        for (let i = 1; i <= part.length; i++) {
                            const testPart = normalizeBrand(part.substring(0, i)).toLowerCase();
                            if (testPart === brandNormalized) {
                                brandEndIndex = i;
                                break;
                            } else if (testPart.length > brandNormalized.length) {
                                break;
                            }
                        }
                        if (brandEndIndex === -1) {
                            brandEndIndex = matchedBrand.length; // Fallback
                        }
                    }
                    
                    if (brandEndIndex === -1) {
                        // Couldn't find exact match, use fallback
                        brandEndIndex = matchedBrand.length;
                    }
                    
                    // Extract model part
                    let modelPart = part.substring(brandEndIndex).trim();
                    
                    // Always add a space between brand and model if model exists
                    if (modelPart) {
                        modelPart = ' ' + modelPart;
                    }
                    
                    // Use normalized brand name (Mercedes-Benz instead of Mercedes Benz)
                    const normalizedBrand = matchedBrand; // Already normalized from vehicleBrands
                    
                    if (modelPart) {
                        return `<strong>${normalizedBrand}</strong>${modelPart}`;
                    } else {
                        return `<strong>${normalizedBrand}</strong>`;
                    }
                }
                
                // If no brand found, return as is
                return part;
            });
            
            // Join parts and replace ", " between brands (where one part ends with </strong> and next starts with <strong>) with "; "
            let result = formattedParts.join(', ');
            
            // Replace ", " between different brands (where </strong> is followed by <strong>) with "; "
            // This handles cases where there might be text (models) after </strong> before the comma
            // Pattern: </strong> followed by optional text, then comma and space, then <strong>
            result = result.replace(/<\/strong>([^<]*?),\s*<strong>/g, '</strong>$1; <strong>');
            
            return result;
        }

        // Calculate and display damaged vehicle category
        function calculateDamagedVehicleCategory() {
            const rokProvozu = document.getElementById('rokProvozu').value;
            const znackaPoskozene = document.getElementById('znackaPoskozene').value;
            const modelPoskozene = document.getElementById('modelPoskozene').value;
            const section = document.getElementById('damagedVehicleCategorySection');

            // Check if all fields are filled
            if (!rokProvozu || !znackaPoskozene || !modelPoskozene) {
                section.style.display = 'none';
                return;
            }

            // Find category of damaged vehicle
            let damagedCategory = findCategory(znackaPoskozene, modelPoskozene);
            if (!damagedCategory) {
                section.style.display = 'none';
                return;
            }

            // Check if vehicle is older than 8 years
            const currentYear = new Date().getFullYear();
            const yearOfProduction = parseInt(rokProvozu);
            let finalCategory = damagedCategory;
            let categoryNote = '';
            let apply20PercentDiscount = false; // Flag for 20% discount for vehicles older than 8 years

            if (!isNaN(yearOfProduction) && (currentYear - yearOfProduction) > 8) {
                // Vehicle is older than 8 years, apply 20% discount instead of category reduction
                apply20PercentDiscount = true;
                // Keep original category, no downgrade needed
                finalCategory = damagedCategory;
                categoryNote = 'Sazba snížena o 20 % (poškozené vozidlo je starší 8 let)';
            }

            // Get price for final category
            let price = null;
            if (finalCategory === 'vozy Škoda' && znackaPoskozene && modelPoskozene) {
                price = findPriceByCategory(finalCategory, znackaPoskozene, modelPoskozene);
            } else {
                price = findPriceByCategory(finalCategory);
            }

            if (!price) {
                section.style.display = 'none';
                return;
            }

            // Normalize price structure (handle both finalPriceEntry and findPriceByCategory return formats)
            let price1_10 = price.cena_1_10 || price.cena_1_10_dni;
            let price11_30 = price.cena_11_30 || price.cena_11_30_dni;

            if (!price1_10 || !price11_30) {
                section.style.display = 'none';
                return;
            }

            // Apply 20% discount if vehicle is older than 8 years
            if (apply20PercentDiscount) {
                price1_10 = Math.round(price1_10 * 0.8);
                price11_30 = Math.round(price11_30 * 0.8);
            }

            // Display category name (no equivalent category display for Škoda)
            // Replace "vozy Škoda" with "Škoda" for display
            let categoryDisplayName = finalCategory === 'vozy Škoda' ? 'Škoda' : finalCategory;
            const categoryNameElement = document.getElementById('damagedCategoryName');
            categoryNameElement.textContent = categoryDisplayName;
            
            // Display note if category was reduced
            const noteElement = document.getElementById('damagedCategoryNote');
            if (categoryNote) {
                noteElement.textContent = categoryNote;
                noteElement.style.display = 'block';
            } else {
                noteElement.textContent = '';
                noteElement.style.display = 'none';
            }

            // Display rates
            document.getElementById('damagedRate1_10').textContent = price1_10.toLocaleString('cs-CZ') + ' Kč bez DPH';
            document.getElementById('damagedRate11_30').textContent = price11_30.toLocaleString('cs-CZ') + ' Kč bez DPH';

            // Update print "Výsledná sazba" block for poškozené vozidlo
            // tak aby tiskové hodnoty odpovídaly této části výpočtu.
            const printPrice1_10 = document.getElementById('printPrice1_10');
            const printPrice11_30 = document.getElementById('printPrice11_30');
            if (printPrice1_10) {
                printPrice1_10.textContent = price1_10.toLocaleString('cs-CZ') + ' Kč bez DPH';
            }
            if (printPrice11_30) {
                printPrice11_30.textContent = price11_30.toLocaleString('cs-CZ') + ' Kč bez DPH';
            }

            // Generate models list for this category
            // Pro „vozy Škoda“ zobraz pouze modely z konkrétního řádku ceníku,
            // na kterém je vybraný poškozený model. Pro ostatní kategorie ponech
            // původní chování – všechny řádky v dané kategorii.
            const categoryModels = cenÝkData.filter(data => data.kategorie === finalCategory);
            
            let allModelsText = '';
            
            if (finalCategory === 'vozy Škoda' && znackaPoskozene && modelPoskozene) {
                const damagedModelLower = modelPoskozene.toLowerCase().trim();
                
                // Najdi konkrétní řádek „vozy Škoda“ podle stejné logiky jako pro autocomplete:
                // - pro verze „Octavia I + II“ / „Octavia III + IV“ vyber správný řádek podle římské číslice
                // - pro ostatní modely (Citigo, Fabia, Scala, Kamiq, …) stačí přesná shoda názvu modelu
                const skodaRow = cenÝkData.find(data => {
                    if (!data.kategorie || !data.kategorie.toLowerCase().includes('škoda')) return false;
                    
                    const znackaTyp = data.znacka_typ || '';
                    
                    // Nejprve zkus zachytit pattern typu „Octavia I + II“
                    const fullVersionPattern = /^([A-Za-z\s]+)\s+([IVX]+)\s*\+\s*([IVX]+)$/i;
                    const fullVersionMatch = znackaTyp.match(fullVersionPattern);
                    
                    if (fullVersionMatch) {
                        const baseModel = fullVersionMatch[1].trim();   // např. „Octavia“
                        const version1 = fullVersionMatch[2].trim();    // „I“
                        const version2 = fullVersionMatch[3].trim();    // „II“
                        
                        const model1 = (baseModel + ' ' + version1).toLowerCase();
                        const model2 = (baseModel + ' ' + version2).toLowerCase();
                        
                        // Shoda „Octavia I“ nebo „Octavia II“ přesně na tento řádek
                        if (damagedModelLower === model1 || damagedModelLower === model2) {
                            return true;
                        }
                        
                        // Pokud by někdo zadal jen „Octavia“, přiřadíme ho na první řádek s Octavií
                        if (damagedModelLower === baseModel.toLowerCase()) {
                            return true;
                        }
                        
                        return false;
                    }
                    
                    // Ostatní řádky Škoda – např. „Fabia + Roomster“, „Scala + Kamiq + Yeti“
                    const skodaModels = znackaTyp.split('+').map(m => m.trim()).filter(Boolean);
                    for (const m of skodaModels) {
                        const modelLower = m.toLowerCase();
                        if (damagedModelLower === modelLower) {
                            return true;
                        }
                    }
                    
                    return false;
                });
                
                if (skodaRow && skodaRow.znacka_typ) {
                    allModelsText = skodaRow.znacka_typ;
                } else if (categoryModels.length > 0) {
                    // Fallback – pokud by se konkrétní řádek nenašel, zobraz všechny řádky jako dříve
                    allModelsText = categoryModels.map(item => item.znacka_typ).join(', ');
                }
            } else if (categoryModels.length > 0) {
                // Ostatní kategorie – zachovat původní logiku (všechny řádky v kategorii)
                allModelsText = categoryModels.map(item => item.znacka_typ).join(', ');
            }
            
            // Format the text using the same function as in price list (makes brands bold, replaces + with ,, etc.)
            let formattedText = '';
            if (allModelsText) {
                formattedText = formatBrandModelText(allModelsText, finalCategory);
            } else {
                formattedText = 'Různé modely vozidel';
            }
            
            // Display formatted summary in category section (use innerHTML to render HTML formatting)
            const modelsSummary = document.getElementById('categoryModelsSummary');
            const modelsSummaryText = document.querySelector('#categoryModelsSummary .models-summary-text');
            if (modelsSummary && modelsSummaryText) {
                modelsSummaryText.innerHTML = formattedText;
                modelsSummary.style.display = 'block';
            }

            // Also propagate formatted models list into print summary box
            const printModelsBox = document.getElementById('printCategoryModelsBox');
            const printModelsText = document.getElementById('printCategoryModelsText');
            if (printModelsBox && printModelsText) {
                printModelsText.innerHTML = formattedText;
                printModelsBox.style.display = formattedText ? 'block' : 'none';
            }

            // Show section
            section.style.display = 'block';
            
            // Trigger animation by adding visible class after a small delay
            setTimeout(() => {
                section.classList.add('visible');
            }, 10);
            
            // Update print date when category section is shown
            updatePrintDate();
            
            // Update buttons visibility when category section is shown
            updateButtonsVisibility();
        }
        
        // Function to update print date
        function updatePrintDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('cs-CZ', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            const printDateElement = document.getElementById('printDate');
            if (printDateElement) {
                printDateElement.textContent = dateStr;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add loaded class to form container for fade-in animation
            const formContainer = document.querySelector('.form-container');
            if (formContainer) {
                formContainer.classList.add('loaded');
            }
            
            populateDropdowns();

            document.getElementById('calculateBtn').addEventListener('click', calculate);
            
            // Function to reset calculation form
            function resetCalculation() {
                // Reset form inputs
                document.getElementById('rokProvozu').value = '';
                document.getElementById('znackaPoskozene').value = '';
                document.getElementById('modelPoskozene').value = '';
                document.getElementById('znackaPronajmene').value = '';
                document.getElementById('modelPronajmene').value = '';
                hideCalculationMessage();
                
                // Hide results section
                const resultsSection = document.getElementById('resultsSection');
                resultsSection.classList.remove('visible');
                setTimeout(() => {
                    resultsSection.style.display = 'none';
                }, 300); // Wait for animation to complete
                resultsSection.classList.remove('show-in-print');
                
                // Hide new result elements
                const rentalVehicleIntroText = document.getElementById('rentalVehicleIntroText');
                const discountInfo = document.getElementById('discountInfo');
                if (rentalVehicleIntroText) rentalVehicleIntroText.style.display = 'none';
                if (discountInfo) discountInfo.style.display = 'none';
                
                // Hide models summary in category section
                const modelsSummary = document.getElementById('categoryModelsSummary');
                if (modelsSummary) {
                    modelsSummary.style.display = 'none';
                }
                
                // Remove print class from rental section
                const rentalSection = document.querySelector('.form-section:nth-of-type(3)');
                if (rentalSection) {
                    rentalSection.classList.remove('show-in-print');
                }
                
                // Hide damaged vehicle category section
                document.getElementById('damagedVehicleCategorySection').style.display = 'none';
                
                // Hide buttons
                const actionButtonsContainer = document.getElementById('actionButtonsContainer');
                if (actionButtonsContainer) actionButtonsContainer.style.display = 'none';
                
                // Clear autocomplete dropdowns
                document.querySelectorAll('.autocomplete-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                
                // Reset model inputs (disable them)
                document.getElementById('modelPoskozene').disabled = true;
                document.getElementById('modelPronajmene').disabled = true;
                
                // Scroll to top of form
                document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
             // Make resetCalculation available globally for onclick
             window.resetCalculation = resetCalculation;
            
            // Show/hide buttons based on what is filled
            function updateButtonsVisibility() {
                const rokProvozu = document.getElementById('rokProvozu').value.trim();
                const znackaPoskozene = document.getElementById('znackaPoskozene').value.trim();
                const modelPoskozene = document.getElementById('modelPoskozene').value.trim();
                const znackaPronajmene = document.getElementById('znackaPronajmene').value.trim();
                const modelPronajmene = document.getElementById('modelPronajmene').value.trim();
                const actionButtonsContainer = document.getElementById('actionButtonsContainer');
                const categorySection = document.getElementById('damagedVehicleCategorySection');
                
                // Check if damaged vehicle has required data
                const hasDamagedData = rokProvozu && znackaPoskozene && modelPoskozene;
                
                // Check if rental vehicle has any data filled
                const hasRentalData = znackaPronajmene || modelPronajmene;
                
                // Show buttons if damaged vehicle category is shown OR if any form data is filled
                if (actionButtonsContainer) {
                    if ((categorySection && categorySection.style.display !== 'none') || hasDamagedData || hasRentalData) {
                        actionButtonsContainer.style.display = 'flex';
                        updatePrintDate();
                    } else {
                        actionButtonsContainer.style.display = 'none';
                    }
                }
            }
            
            // Make updateButtonsVisibility available globally
            window.updateButtonsVisibility = updateButtonsVisibility;
            
            // Listen for changes in rental vehicle fields
            const znackaPronajmene = document.getElementById('znackaPronajmene');
            const modelPronajmene = document.getElementById('modelPronajmene');
            
            znackaPronajmene.addEventListener('input', updateButtonsVisibility);
            znackaPronajmene.addEventListener('change', updateButtonsVisibility);
            modelPronajmene.addEventListener('input', updateButtonsVisibility);
            modelPronajmene.addEventListener('change', updateButtonsVisibility);
            
            // Also check when autocomplete items are selected
            const znackaPronajmeneDropdown = document.getElementById('znackaPronajmeneDropdown');
            const modelPronajmeneDropdown = document.getElementById('modelPronajmeneDropdown');
            
            znackaPronajmeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(updateButtonsVisibility, 100);
                }
            });
            
            modelPronajmeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(updateButtonsVisibility, 100);
                }
            });
            
            // Update print date when results section is shown
            const resultsSection = document.getElementById('resultsSection');
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        if (resultsSection.style.display !== 'none') {
                            updatePrintDate();
                        }
                    }
                });
            });
            observer.observe(resultsSection, { attributes: true, attributeFilter: ['style'] });
            
            // Also update print date when category section is shown
            const categorySection = document.getElementById('damagedVehicleCategorySection');
            const categoryObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        if (categorySection.style.display !== 'none') {
                            updatePrintDate();
                        }
                    }
                });
            });
            categoryObserver.observe(categorySection, { attributes: true, attributeFilter: ['style'] });

            // Add event listeners for damaged vehicle fields
            const rokProvozu = document.getElementById('rokProvozu');
            const znackaPoskozene = document.getElementById('znackaPoskozene');
            const modelPoskozene = document.getElementById('modelPoskozene');

            // Add event listeners for damaged vehicle fields - auto-recalculate on change
            rokProvozu.addEventListener('input', calculateDamagedVehicleCategory);
            rokProvozu.addEventListener('change', calculateDamagedVehicleCategory);
            znackaPoskozene.addEventListener('input', calculateDamagedVehicleCategory);
            znackaPoskozene.addEventListener('change', calculateDamagedVehicleCategory);
            modelPoskozene.addEventListener('input', calculateDamagedVehicleCategory);
            modelPoskozene.addEventListener('change', calculateDamagedVehicleCategory);
            
            // Initial calculation if fields are already filled
            setTimeout(() => {
                calculateDamagedVehicleCategory();
                updateButtonsVisibility();
            }, 100);

            // Also listen for autocomplete selections
            const rokProvozuDropdown = document.getElementById('rokProvozuDropdown');
            const znackaPoskozeneDropdown = document.getElementById('znackaPoskozeneDropdown');
            const modelPoskozeneDropdown = document.getElementById('modelPoskozeneDropdown');

            rokProvozuDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(calculateDamagedVehicleCategory, 100);
                }
            });

            znackaPoskozeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(calculateDamagedVehicleCategory, 100);
                }
            });

            modelPoskozeneDropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    setTimeout(calculateDamagedVehicleCategory, 100);
                }
            });
        });
    </script>
</body>
</html>

